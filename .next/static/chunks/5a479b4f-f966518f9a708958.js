"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[56],{3749:function(t,e,i){i.d(e,{A1:function(){return t4},FP:function(){return w},Qz:function(){return A},ZP:function(){return tP},qE:function(){return ee}});var s,r,n,o,a,l,h,_=i(7883),u=i(2338),d=i(4776),c=i(8241),E=i(3993),m=i(4563);function p(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{l(s.next(t))}catch(t){n(t)}}function a(t){try{l(s.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof i?e:new i(function(t){t(e)})).then(o,a)}l((s=s.apply(t,e||[])).next())})}class g extends Error{constructor(t,e){super(t),Object.setPrototypeOf(this,g.prototype),this.name="View360Error",this.code=e}}var T={CODES:{WRONG_TYPE:0,WRONG_OPTION:1,ELEMENT_NOT_FOUND:2,CANVAS_NOT_FOUND:3,WEBGL_NOT_SUPPORTED:4,FAILED_CREATE_CONTEXT_2D:5,PROVIDE_PROJECTION_FIRST:6,FAILED_LINKING_PROGRAM:7,INSUFFICIENT_ARGS:8},MESSAGES:{WRONG_TYPE:(t,e)=>"".concat(typeof t," is not a ").concat(e.map(t=>'"'.concat(t,'"')).join(" or "),"."),WRONG_OPTION:(t,e)=>'Bad option: given "'.concat(t,'" for option "').concat(e,'".'),ELEMENT_NOT_FOUND:t=>'Element with selector "'.concat(t,'" not found.'),CANVAS_NOT_FOUND:"The canvas element was not found inside the given root element.",WEBGL_NOT_SUPPORTED:"WebGL is not supported on this browser.",FAILED_CREATE_CONTEXT_2D:"Failed to create canvas 2D context",PROVIDE_PROJECTION_FIRST:'"projection" should be provided before initialization.',FAILED_LINKING_PROGRAM:(t,e)=>'Failed linking WebGL program - "'.concat(t,"\nShader compile Log: ").concat(e),INSUFFICIENT_ARGS:(t,e)=>'Insufficient arguments: given "'.concat(t,'" for "').concat(e,'".')}};let v={MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_UP:"mouseup",TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",WHEEL:"wheel",RESIZE:"resize",CONTEXT_MENU:"contextmenu",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",KEY_DOWN:"keydown",KEY_UP:"keyup",CLICK:"click",CONTEXT_CREATE_ERROR:"webglcontextcreationerror",CONTEXT_LOST:"webglcontextlost",CONTEXT_RESTORED:"webglcontextrestored",DEVICE_ORIENTATION:"deviceorientation",DEVICE_MOTION:"devicemotion",ORIENTATION_CHANGE:"orientationchange",VIDEO_PLAY:"play",VIDEO_PAUSE:"pause",VIDEO_LOADED_DATA:"loadeddata",VIDEO_VOLUME_CHANGE:"volumechange",VIDEO_TIME_UPDATE:"timeupdate",VIDEO_DURATION_CHANGE:"durationchange",VIDEO_CAN_PLAYTHROUGH:"canplaythrough",TRANSITION_END:"transitionend",XR_END:"end"},b="button";(s=o||(o={}))[s.LEFT=0]="LEFT",s[s.MIDDLE=1]="MIDDLE",s[s.RIGHT=2]="RIGHT";let O={GRAB:"grab",GRABBING:"grabbing",NONE:""},C=["LEFT","UP","RIGHT","DOWN"];(r=a||(a={}))[r.LEFT=37]="LEFT",r[r.UP=38]="UP",r[r.RIGHT=39]="RIGHT",r[r.DOWN=40]="DOWN";let R={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"},I=["requestFullscreen","webkitRequestFullscreen","webkitRequestFullScreen","webkitCancelFullScreen","mozRequestFullScreen","msRequestFullscreen"],L=["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"],N=["exitFullscreen","webkitExitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen"],f=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],A={CONTAINER:"view360-container",CANVAS:"view360-canvas",CTX_LOST:"view360-ctx-lost",IN_VR:"view360-vr-presenting",HOTSPOT_CONTAINER:"view360-hotspots",HOTSPOT:"view360-hotspot",HOTSPOT_VISIBLE:"view360-hotspot-visible",HOTSPOT_FLIP_X:"view360-hotspot-flip-x",HOTSPOT_FLIP_Y:"view360-hotspot-flip-y"},w={READY:"ready",LOAD_START:"loadStart",LOAD:"load",PROJECTION_CHANGE:"projectionChange",RESIZE:"resize",BEFORE_RENDER:"beforeRender",RENDER:"render",INPUT_START:"inputStart",INPUT_END:"inputEnd",VIEW_CHANGE:"viewChange",STATIC_CLICK:"staticClick",VR_START:"vrStart",VR_END:"vrEnd"},y={ANIMATION_END:"animationEnd"},S={INPUT_START:"inputStart",CHANGE:"change",INPUT_END:"inputEnd",ENABLE:"enable",DISABLE:"disable",STATIC_CLICK:"staticClick"},D=Math.PI/180,x=180/Math.PI,P=t=>1-Math.pow(1-t,3),U={min:-1/0,max:1/0},M={min:-90,max:90},B={min:.6,max:10};(n=h||(h={}))[n.ZERO=0]="ZERO",n[n.CW_90=1]="CW_90",n[n.CCW_90=2]="CCW_90",n[n.CW_180=3]="CW_180";let F="view360videotimechange",V="http://www.w3.org/2000/svg",G="immersive-vr",H="local",z=null!==(l=Number.EPSILON)&&void 0!==l?l:2220446049250313e-31,k=t=>"string"==typeof t,Y=t=>!!t&&t.nodeType===Node.ELEMENT_NODE,W=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",i=document.createElement(e);return i.classList.add(t),i},K=(t,e)=>{let i=null;if(k(t)){let s=(e||document).querySelector(t);if(!s)return null;i=s}else Y(t)&&(i=t);return i},X=(t,e)=>{let i=K(t,e);if(!i){if(k(t))throw new g(T.MESSAGES.ELEMENT_NOT_FOUND(t),T.CODES.ELEMENT_NOT_FOUND);throw new g(T.MESSAGES.WRONG_TYPE(t,["HTMLElement","string"]),T.CODES.WRONG_TYPE)}return i},j=(t,e)=>{let i=t.querySelector(e);if(!i)throw new g(T.MESSAGES.CANVAS_NOT_FOUND,T.CODES.CANVAS_NOT_FOUND);return i},Z=(t,e,i)=>Math.max(Math.min(t,i),e),q=(t,e,i)=>t*(1-i)+e*i,J=(t,e,i)=>{let s=Math.abs(i-e);return t<e?t=i-(e-t)%s:t>i&&(t=e+(t-i)%s),t},Q=(t,e)=>{for(let i=0;i<t.length;i++)if(e(t[i]))return i;return -1},$=t=>"object"==typeof t?t:{},tt=(t,e)=>2*Math.atan(Math.tan(.5*t)/e),te=()=>{if(!document)return!1;for(let t of L)if(document[t])return!0;return!1},ti=()=>window.isSecureContext&&!!DeviceMotionEvent&&"requestPermission"in DeviceMotionEvent,ts=(t,e)=>Math.tan(D*t*.5)/Math.tan(D*e*.5),tr=(t,e,i,s)=>{u.yR(t);let r=Z(i,-89.99,89.99);return u.uD(t,t,e*D),u.lM(t,t,r*D),u.jI(t,t,s*D),t},tn=t=>{let e,i;let s=t[0],r=t[1],n=t[2],o=t[3],a=s*s+r*r+n*n+o*o,l=s*o-r*n;if(l>.499995*a)e=Math.PI/2,i=2*Math.atan2(r,s);else if(l<-.499995*a)e=-Math.PI/2,i=-2*Math.atan2(r,s);else{let s=d.al(0,0,1),r=d.al(0,1,0);d.VC(s,s,t),d.VC(r,r,t);let n=Math.sqrt(s[0]*s[0]+s[2]*s[2]);e=Math.atan2(-s[1],n),i=Math.atan2(s[0],s[2])}return{pitch:Z(e*x,-90,90),yaw:J(i*x,0,360)}};class to{get val(){return this._val}get start(){return this._start}get end(){return this._end}get progress(){return this._progress}get activated(){return this._activated}get duration(){return this._duration}set duration(t){this._duration=t}get loop(){return this._loop}set loop(t){this._loop=t}get range(){return this._range}get easing(){return this._easing}set easing(t){this._easing=t}update(t){if(!this._activated)return this._val=this._end,0;let e=this._start,i=this._end,s=this._duration,r=this._val,n=this._loop,o=this._progress+t/s;this._progress=n?J(o,0,1):Z(o,0,1);let a=this._easing(this._progress);return this._val=q(e,i,a),!n&&this._progress>=1&&(this._activated=!1),this._val-r}reset(t){let e=this._range,i=Z(t,e.min,e.max);this._start=i,this._end=i,this._val=i,this._progress=0,this._activated=!1}add(t){let e=this._range;this._start=Z(this._start+t,e.min,e.max),this._end=Z(this._end+t,e.min,e.max),this._val=Z(this._val+t,e.min,e.max)}setNewEndByDelta(t){let e=this._range;this._start=this._val,this._end=Z(this._end+t,e.min,e.max),this._progress=0,this._activated=!0}setRange(t,e){this._start=Z(this._start,t,e),this._end=Z(this._end,t,e),this._range={min:t,max:e}}constructor({duration:t=300,loop:e=!1,range:i={min:0,max:1},easing:s=P}={}){this._duration=t,this._loop=e,this._range=i,this._easing=s,this._activated=!1,this.reset(0)}}class ta{get duration(){return this._motion.duration}set duration(t){this._motion.duration=t}get easing(){return this._motion.easing}set easing(t){this._motion.easing=t}getFinishPromise(){return this._finishPromise}update(t){let e=this._camera,i=this._from,s=this._to,r=this._motion;r.update(t);let n=r.val,o=u.Ue(),a=q(i.zoom,s.zoom,n);u.ZA(o,i.rotation,s.rotation,n),e.rotate(o,a),n>=1&&this._finish()}constructor(t,e,i,{duration:s=300,easing:r=P}={}){this._camera=t,this._motion=new to({duration:s,easing:r,range:{min:0,max:1}}),this._from=e,this._to=i,this._finishPromise=new Promise(t=>{this._finish=t}),this._motion.setNewEndByDelta(1)}}class tl extends _.Z{get aspect(){return this._aspect}get changed(){return this._changed}get yawRange(){return this._initialYawRange}set yawRange(t){this._initialYawRange=t}get pitchRange(){return this._initialPitchRange}set pitchRange(t){this._initialPitchRange=t}get zoomRange(){return this._initialZoomRange}set zoomRange(t){this._initialZoomRange=t}destroy(){this.off()}resize(t,e){let i=this._aspect;this._aspect=t/e,this._aspect!==i&&this.updateMatrix()}lookAt(t){let{yaw:e=this.yaw,pitch:i=this.pitch,zoom:s=this.zoom}=t,r=u.d9(this.quaternion),n=this.zoom;this.yaw=J(e,0,360),this.pitch=Z(i,-90,90),this.zoom=s,this._updateQuaternion(),(!u.fS(this.quaternion,r)||Math.abs(s-n)>=10*z)&&this.updateMatrix()}rotate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,i=u.Fv(u.Ue(),t),s=u.fS(this.quaternion,i);u.JG(this.quaternion,i);let r=this.zoom,{yaw:n,pitch:o}=tn(i);this.yaw=n,this.pitch=o,this.zoom=e,(!s||Math.abs(e-r)>=10*z)&&this.updateMatrix()}animateTo(){let{yaw:t=this.yaw,pitch:e=this.pitch,zoom:i=this.zoom,duration:s=0,easing:r=P}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return p(this,void 0,void 0,function*(){if(this.yaw===t&&this.pitch===e&&this.zoom===i)return;let n=new ta(this,{rotation:u.d9(this.quaternion),zoom:this.zoom},{rotation:tr(u.Ue(),t,e,this.rollOffset),zoom:i},{duration:s,easing:r}),o=n.getFinishPromise();return this.animation=n,o.then(()=>{this.animation=null,this.trigger(y.ANIMATION_END,{animation:n})}),o})}restrictYawRange(t,e){this._yawRange={min:t,max:e}}restrictPitchRange(t,e){this._pitchRange={min:t,max:e}}restrictZoomRange(t,e){this._zoomRange={min:t,max:e}}restrictRenderHeight(t){this._maxRenderHeight=t}resetRange(){this._yawRange=this._initialYawRange,this._pitchRange=this._initialPitchRange,this._zoomRange=this._initialZoomRange,this._maxRenderHeight=-1}getYawRange(t){let e=this._yawRange,i=this._maxRenderHeight;if(!e)return U;let s=.5*this.getHorizontalFov(t),r=e.min,n=e.max;if(i>0){let t=tt(s*D,this._aspect),o=.5*i,a=Math.tan(t),l=Math.atan(Math.tan(s*D)*Math.sqrt((1+o*o)/(1+a*a)))*x;r=e.min+l,n=e.max-l}return r>n&&(r=0,n=0),{min:r,max:n}}getPitchRange(t){let e=this._pitchRange,i=this._maxRenderHeight;if(!e)return M;let s=e.min,r=e.max;if(i>0){let i=.5*this.getVerticalFov(t);s=e.min+i,r=e.max-i}return s>r&&(s=0,r=0),{min:Math.max(s,-90),max:Math.min(r,90)}}getZoomRange(){var t;let e=null!==(t=this._zoomRange)&&void 0!==t?t:B;return{min:Math.max(this.getHorizontalFov(e.max),1),max:Math.min(this.getHorizontalFov(e.min),180),current:this.getHorizontalFov(this.zoom)}}getHorizontalFov(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.zoom;return this._getZoomedHorizontalFov(t)*x}getVerticalFov(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.zoom,e=this._aspect;return tt(this._getZoomedHorizontalFov(t),e)*x}fovToZoom(t){return Math.tan(D*this.fov*.5)/Math.tan(D*t*.5)}updateMatrix(){let t=this._up,e=this._aspect,i=this.viewMatrix,s=this.projectionMatrix,r=this.position,n=this.quaternion,o=d.Ue(),a=d.al(0,0,-1);d.VC(a,a,n),d.VC(o,t,n);let l=tt(this._getZoomedHorizontalFov(),e);c.zB(i,r,a,o),c.G3(s,l,e,.1,100),this._changed=!0}onFrameRender(){this._changed=!1}_updateQuaternion(){tr(this.quaternion,this.yaw,this.pitch,this.rollOffset)}_getZoomedHorizontalFov(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.zoom;return 2*Math.atan(Math.tan(D*this.fov*.5)/t)}constructor({initialYaw:t,initialPitch:e,initialZoom:i,yawRange:s,pitchRange:r,zoomRange:n,fov:o}){super(),this.yaw=t,this.pitch=e,this.zoom=i,this.rollOffset=0,this.initialYaw=t,this.initialPitch=e,this.initialZoom=i,this.position=d.Ue(),this.animation=null,this._up=d.al(0,1,0),this._aspect=1,this._initialYawRange=s,this._initialPitchRange=r,this._initialZoomRange=n,this._yawRange=s,this._pitchRange=r,this._zoomRange=n,this.quaternion=u.Ue(),this._updateQuaternion(),this.viewMatrix=c.Ue(),this.projectionMatrix=c.Ue(),this.fov=o,this._maxRenderHeight=-1}}class th extends _.Z{enable(t){this._el||(t.addEventListener(v.MOUSE_DOWN,this._onMouseDown),this._el=t)}disable(){let t=this._el;t&&(t.removeEventListener(v.MOUSE_DOWN,this._onMouseDown),window.removeEventListener(v.MOUSE_MOVE,this._onMouseMove,!1),window.removeEventListener(v.MOUSE_UP,this._onMouseUp,!1),this._el=null)}constructor(){super(),this._onMouseDown=t=>{let e=this._el;e&&t.button===o.LEFT&&(t.preventDefault(),e.focus?e.focus():window.focus(),this._prevPos[0]=t.clientX,this._prevPos[1]=t.clientY,window.addEventListener(v.MOUSE_MOVE,this._onMouseMove,!1),window.addEventListener(v.MOUSE_UP,this._onMouseUp,!1),this.trigger(S.INPUT_START,{srcEvent:t,isTouch:!1,isKeyboard:!1}))},this._onMouseMove=t=>{t.preventDefault();let e=t.clientX,i=t.clientY,s=this._prevPos,r=e-s[0],n=i-s[1];this.trigger(S.CHANGE,{delta:{x:r,y:n},isTouch:!1,isKeyboard:!1}),s[0]=e,s[1]=i},this._onMouseUp=()=>{this._prevPos[0]=0,this._prevPos[1]=0,window.removeEventListener(v.MOUSE_MOVE,this._onMouseMove,!1),window.removeEventListener(v.MOUSE_UP,this._onMouseUp,!1),this.trigger(S.INPUT_END,{isTouch:!1,isKeyboard:!1,scrolling:!1})},this._el=null,this._prevPos=[0,0]}}class t_ extends _.Z{get scrollable(){return this._scrollable}set scrollable(t){this._scrollable=t}enable(t){this._el||(t.addEventListener(v.TOUCH_START,this._onTouchStart,{passive:!1}),t.addEventListener(v.TOUCH_MOVE,this._onTouchMove,{passive:!1}),t.addEventListener(v.TOUCH_END,this._onTouchEnd),this._el=t)}disable(){let t=this._el;t&&(t.removeEventListener(v.TOUCH_START,this._onTouchStart),t.removeEventListener(v.TOUCH_MOVE,this._onTouchMove),t.removeEventListener(v.TOUCH_END,this._onTouchEnd),this._el=null)}constructor(){super(),this._onTouchStart=t=>{if(t.touches.length>1||this._scrolling)return;let e=t.touches[0];this._isFirstTouch=!0,this._prevPos[0]=e.clientX,this._prevPos[1]=e.clientY,this.trigger(S.INPUT_START,{srcEvent:t,isTouch:!0,isKeyboard:!1})},this._onTouchMove=t=>{if(t.touches.length>1||this._scrolling)return;let e=t.touches[0],i=this._scrollable,s=this._prevPos,r=e.clientX,n=e.clientY,o=r-s[0],a=n-s[1];if(this._isFirstTouch){if(i&&!te()&&Math.abs(a)>Math.abs(o)){this._scrolling=!0;return}this._isFirstTouch=!1}!1!==t.cancelable&&t.preventDefault(),this.trigger(S.CHANGE,{delta:{x:o,y:a},isTouch:!0,isKeyboard:!1}),s[0]=r,s[1]=n},this._onTouchEnd=t=>{if(0!==t.touches.length)return;let e=t.touches[0],i=this._prevPos;e?(i[0]=e.clientX,i[1]=e.clientY):(i[0]=0,i[1]=0,this.trigger(S.INPUT_END,{isTouch:!0,isKeyboard:!1,scrolling:this._scrolling})),!1!==t.cancelable&&t.preventDefault(),this._scrolling=!1},this._el=null,this._prevPos=[0,0],this._isFirstTouch=!1,this._scrolling=!1,this._scrollable=!1}}class tu extends _.Z{get active(){let t=this._pressed;return t.LEFT||t.UP||t.RIGHT||t.DOWN}enable(t){this._el||(t.addEventListener(v.KEY_DOWN,this._onKeyDown),t.addEventListener(v.KEY_UP,this._onKeyUp),this._el=t,this._clearPressedKeys())}disable(){let t=this._el;t&&(t.removeEventListener(v.KEY_DOWN,this._onKeyDown),t.removeEventListener(v.KEY_UP,this._onKeyUp),this._el=null,this._clearPressedKeys())}update(){let t=this._getDeltaByPressedKeys();(0!==t.x||0!==t.y)&&this.trigger(S.CHANGE,{delta:t,isTouch:!1,isKeyboard:!0})}_clearPressedKeys(){this._pressed=C.reduce((t,e)=>Object.assign(Object.assign({},t),{[e]:!1}),{})}_updateKeyPress(t,e){let i=this._pressed,s=null!=t.keyCode?a[t.keyCode]:R[t.key];s&&(i[s]=e)}_getPressedKeyCount(){return C.filter(t=>this._pressed[t]).length}_getDeltaByPressedKeys(){let t=this._pressed,e=0,i=0;return t.LEFT&&(e+=1),t.RIGHT&&(e-=1),t.UP&&(i+=1),t.DOWN&&(i-=1),{x:e,y:i}}constructor(){super(),this._onKeyDown=t=>{if(t.location!==KeyboardEvent.DOM_KEY_LOCATION_STANDARD)return;this._updateKeyPress(t,!0);let e=this._getPressedKeyCount();e<=0||(t.preventDefault(),1!==e||t.repeat||this.trigger(S.INPUT_START,{srcEvent:t,isTouch:!1,isKeyboard:!0}))},this._onKeyUp=t=>{t.location===KeyboardEvent.DOM_KEY_LOCATION_STANDARD&&(this._updateKeyPress(t,!1),this._getPressedKeyCount()>0||this.trigger(S.INPUT_END,{isTouch:!1,isKeyboard:!0,scrolling:!1}))},this._el=null,this._clearPressedKeys()}}class td extends _.Z{get enabled(){return this._enabled}get enableBlocked(){return this._enableBlocked}get animating(){return this._keyboardInput.active||this._xMotion.activated||this._yMotion.activated}get yaw(){return this._xMotion}get pitch(){return this._yMotion}get scrollable(){return this._touchInput.scrollable}set scrollable(t){this._touchInput.scrollable=t}get pointerScale(){return this._pointerScale}set pointerScale(t){this._pointerScale=t}get keyboardScale(){return this._keyboardScale}set keyboardScale(t){this._keyboardScale=t}get duration(){return this._duration}set duration(t){this._duration=t,this._xMotion.duration=t,this._yMotion.duration=t}get easing(){return this._easing}set easing(t){this._easing=t,this._xMotion.easing=t,this._yMotion.easing=t}get disablePitch(){return this._disablePitch}set disablePitch(t){this._disablePitch=t}get disableYaw(){return this._disableYaw}set disableYaw(t){this._disableYaw=t}get disableKeyboard(){return this._disableKeyboard}set disableKeyboard(t){this._disableKeyboard=t}destroy(){this.disable(),this._mouseInput.off(),this._touchInput.off(),this._keyboardInput.off(),this.off(),this._changedWhileDragging=!1}update(t){if(!this._enabled)return;let e=this._xMotion,i=this._yMotion,s=this._keyboardInput;this._disableKeyboard||s.update(),this._disablePitch||i.update(t),this._disableYaw||e.update(t)}updateRange(t,e){let i=t.getYawRange(e),s=t.getPitchRange(e);this._xMotion.setRange(i.min,i.max),this._yMotion.setRange(s.min,s.max)}setZoomScale(t){this._zoomScale=t}resize(t,e,i,s){let r=tt(t*D,e)*x;this._screenScale[0]=t/i,this._screenScale[1]=r/s}enable(){if(this._enabled)return;let t=this._controlEl;this._mouseInput.enable(t),this._touchInput.enable(t),this._keyboardInput.enable(t),this._enabled=!0,this._enableBlocked=!1,this.trigger(S.ENABLE,{control:this,updateCursor:!0})}disable(){this._enabled&&(this._mouseInput.disable(),this._touchInput.disable(),this._keyboardInput.disable(),this._enabled=!1,this.trigger(S.DISABLE,{updateCursor:!0}))}sync(t){this.updateRange(t,t.zoom),this._xMotion.reset(t.yaw),this._yMotion.reset(t.pitch)}_bindInputs(){let t=this._mouseInput,e=this._touchInput,i=this._keyboardInput;t.on(S.INPUT_START,this._onInputStart),t.on(S.CHANGE,this._onChange),t.on(S.INPUT_END,this._onInputEnd),e.on(S.INPUT_START,this._onInputStart),e.on(S.CHANGE,this._onChange),e.on(S.INPUT_END,this._onInputEnd),i.on(S.INPUT_START,this._onInputStart),i.on(S.CHANGE,this._onChange),i.on(S.INPUT_END,this._onInputEnd)}constructor(t,e,{duration:i=300,easing:s=P,pointerScale:r=[1,1],keyboardScale:n=[1,1],disablePitch:o=!1,disableYaw:a=!1,disableKeyboard:l=!1}={}){super(),this._onInputStart=t=>{this._changedWhileDragging=!1,this.trigger(S.INPUT_START,Object.assign(Object.assign({},t),{inputType:"rotate"}))},this._onChange=t=>{let e;let i=t.delta,s=1/this._zoomScale,r=this._screenScale,n=this._keyboardScale,o=this._pointerScale;e=t.isKeyboard?[n[0]*s,n[1]*s]:[o[0]*r[0]*s,o[1]*r[1]*s];let a=i.x*e[0],l=i.y*e[1];this._xMotion.setNewEndByDelta(a),this._yMotion.setNewEndByDelta(l),this._changedWhileDragging=!0},this._onInputEnd=t=>{this.trigger(S.INPUT_END,Object.assign(Object.assign({},t),{inputType:"rotate"})),this._changedWhileDragging||t.isKeyboard||t.scrolling||this.trigger(S.STATIC_CLICK,{isTouch:t.isTouch}),this._changedWhileDragging=!1},this._controlEl=t,this._pointerScale=r,this._keyboardScale=n,this._duration=i,this._easing=s,this._disablePitch=o,this._disableYaw=a,this._disableKeyboard=l,this._enableBlocked=e,this._mouseInput=new th,this._touchInput=new t_,this._keyboardInput=new tu,this._xMotion=new to({duration:i,range:U,easing:s}),this._yMotion=new to({duration:i,range:M,easing:s}),this._screenScale=[1,1],this._zoomScale=1,this._enabled=!1,this._changedWhileDragging=!1,this._bindInputs()}}class tc extends _.Z{get scrollable(){return this._scrollable}set scrollable(t){this._scrollable=t}enable(t){this._el||(t.addEventListener(v.WHEEL,this._onWheel,{passive:!1,capture:!1}),this._el=t,this._clearTimer())}disable(){let t=this._el;t&&(t.removeEventListener(v.WHEEL,this._onWheel,!1),this._el=null,this._clearTimer())}_clearTimer(){window.clearTimeout(this._inputTimer),this._inputTimer=-1}constructor(){super(),this._onWheel=t=>{let e=this._scrollable;if(0===t.deltaY||e)return;t.preventDefault(),t.stopPropagation(),this._inputTimer<0?this.trigger(S.INPUT_START,{srcEvent:t,isTouch:!1,isKeyboard:!1}):this._clearTimer();let i=this._baseScale*t.deltaY;this.trigger(S.CHANGE,{delta:i,isTouch:!1,isKeyboard:!1}),this._inputTimer=window.setTimeout(()=>{this.trigger(S.INPUT_END,{isTouch:!1,isKeyboard:!1,scrolling:!1}),this._inputTimer=-1},300)},this._el=null,this._baseScale=.04,this._scrollable=!1,this._inputTimer=-1}}class tE extends _.Z{enable(t){this._el||(t.addEventListener(v.TOUCH_MOVE,this._onTouchMove,{passive:!1,capture:!1}),t.addEventListener(v.TOUCH_END,this._onTouchEnd),this._el=t,this._prevDistance=-1,this._isFirstTouch=!0)}disable(){let t=this._el;t&&(t.removeEventListener(v.TOUCH_MOVE,this._onTouchMove,!1),t.removeEventListener(v.TOUCH_END,this._onTouchEnd),this._el=null)}constructor(){super(),this._onTouchMove=t=>{let e=t.touches;if(2!==e.length||!t.cancelable)return;t.preventDefault(),t.stopPropagation();let i=this._prevDistance,s=[e[0].pageX-e[1].pageX,e[0].pageY-e[1].pageY],r=Math.sqrt(s[0]*s[0]+s[1]*s[1])*this._baseScale,n=this._isFirstTouch?0:r-i;this._isFirstTouch&&this.trigger(S.INPUT_START,{srcEvent:t,isTouch:!0,isKeyboard:!1}),this._prevDistance=r,this._isFirstTouch=!1,this.trigger(S.CHANGE,{delta:n,isTouch:!0,isKeyboard:!1})},this._onTouchEnd=t=>{0===t.touches.length&&(this._isFirstTouch||this.trigger(S.INPUT_END,{isTouch:!0,isKeyboard:!1,scrolling:!1}),this._prevDistance=-1,this._isFirstTouch=!0)},this._el=null,this._baseScale=-.2,this._prevDistance=-1,this._isFirstTouch=!0}}class tm extends _.Z{get enabled(){return this._enabled}get enableBlocked(){return this._enableBlocked}get animating(){return this._motion.activated}get zoom(){return this._motion.val}get scrollable(){return this._wheelInput.scrollable}set scrollable(t){this._wheelInput.scrollable=t}get range(){return this._motion.range}get scale(){return this._scale}set scale(t){this._scale=t}get duration(){return this._motion.duration}get easing(){return this._motion.easing}destroy(){this.disable(),this._wheelInput.off(),this._pinchInput.off(),this.off()}update(t){this._enabled&&this._motion.update(t)}enable(){if(this._enabled)return;let t=this._controlEl;this._wheelInput.enable(t),this._pinchInput.enable(t),this._enabled=!0,this._enableBlocked=!1,this.trigger(S.ENABLE,{control:this,updateCursor:!1})}disable(){this._enabled&&(this._wheelInput.disable(),this._pinchInput.disable(),this._enabled=!1,this.trigger(S.DISABLE,{updateCursor:!1}))}sync(t){let e=this._motion,i=t.getZoomRange();e.setRange(i.min,i.max),e.reset(i.current)}_bindInputs(){let t=this._wheelInput,e=this._pinchInput;t.on(S.INPUT_START,this._onInputStart),t.on(S.CHANGE,this._onChange),t.on(S.INPUT_END,this._onInputEnd),e.on(S.INPUT_START,this._onInputStart),e.on(S.CHANGE,this._onChange),e.on(S.INPUT_END,this._onInputEnd)}constructor(t,e,{scale:i=1,duration:s=300,easing:r=P}={}){super(),this._onInputStart=t=>{this.trigger(S.INPUT_START,Object.assign(Object.assign({},t),{inputType:"zoom"}))},this._onChange=t=>{let{delta:e}=t,i=this._scale;this._motion.setNewEndByDelta(e*i)},this._onInputEnd=t=>{this.trigger(S.INPUT_END,Object.assign(Object.assign({},t),{inputType:"zoom"}))},this._scale=i,this._controlEl=t,this._enableBlocked=e,this._wheelInput=new tc,this._pinchInput=new tE,this._motion=new to({duration:s,easing:r,range:U}),this._enabled=!1,this._bindInputs()}}let tp={PITCH_DELTA:1,YAW_DELTA_BY_ROLL:2,YAW_DELTA_BY_YAW:3};tp[tp.PITCH_DELTA]={targetAxis:[0,1,0],meshPoint:[0,0,1]},tp[tp.YAW_DELTA_BY_ROLL]={targetAxis:[0,1,0],meshPoint:[1,0,0]},tp[tp.YAW_DELTA_BY_YAW]={targetAxis:[1,0,0],meshPoint:[0,0,1]};class tg extends _.Z{get enabled(){return this._enabled}get orientationUpdated(){return this._orientationUpdated}get ignoreRoll(){return this._ignoreRoll}set ignoreRoll(t){this._ignoreRoll=t}enable(){this._enabled||(window.addEventListener(v.DEVICE_ORIENTATION,this._onDeviceOrientation),window.addEventListener(v.ORIENTATION_CHANGE,this._updateScreenOrientation),this._updateScreenOrientation(),this._orientationUpdated=!1,this._needsCalibrate=!0,this._enabled=!0)}disable(){this._enabled&&(window.removeEventListener(v.DEVICE_ORIENTATION,this._onDeviceOrientation),window.removeEventListener(v.ORIENTATION_CHANGE,this._updateScreenOrientation),this._enabled=!1)}update(){this._updateRotation(),this._orientationUpdated=!1}collectDelta(){if(!this._orientationUpdated)return{pitch:0,yaw:0};let t=u.d9(this.quaternion);return this._updateRotation(),this._orientationUpdated=!1,this._toEulerDelta(t,this.quaternion)}setInitialRotation(t){this._yawOrigin=t}_calibrateSensor(){let t=this._yawOrigin,e=this.quaternion;this._yawOffset=0,this._updateRotation();let{yaw:i}=tn(e);this._yawOffset=i-t,this._updateRotation(),this._needsCalibrate=!1}_updateRotation(){let t=this.quaternion,{alpha:e,beta:i,gamma:s}=this._orientation;u.yR(t),u.uD(t,t,(e-this._yawOffset)*D),u.lM(t,t,i*D),u.jI(t,t,-s*D);let r=u.Ue(),n=-(.5*this._screenOrientation)*D,o=u.al(-Math.sqrt(.5),0,0,Math.sqrt(.5));u.t8(r,0,Math.sin(n),0,Math.cos(n)),u.Jp(t,t,r),u.Jp(t,t,o),u.Fv(t,t)}_toEulerDelta(t,e){return{yaw:this._getDeltaYaw(t,e),pitch:this._getDeltaPitch(t,e)}}_getDeltaYaw(t,e){let i=this._getRotationDelta(t,e,tp.YAW_DELTA_BY_YAW);return this._getRotationDelta(t,e,tp.YAW_DELTA_BY_ROLL)*Math.sin(this._extractPitchFromQuat(e))+i}_getDeltaPitch(t,e){return this._getRotationDelta(t,e,tp.PITCH_DELTA)}_getRotationDelta(t,e,i){let s;let r=d.al(tp[i].targetAxis[0],tp[i].targetAxis[1],tp[i].targetAxis[2]),n=tp[i].meshPoint,o=u.d9(t),a=u.d9(e);u.Fv(o,o),u.Fv(a,a);let l=d.al(0,0,1),h=d.al(0,0,1);d.VC(l,l,o),d.VC(h,h,a),d.VC(r,r,a);let _=d.AK(r,d.kC(d.Ue(),l,h))>0?1:-1,c=d.al(n[0],n[1],n[2]);s=i!==tp.YAW_DELTA_BY_YAW?d.al(0,_,0):d.al(_,0,0),d.VC(c,c,a),d.VC(s,s,a);let E=d.Ue();d.kC(E,c,s),d.Fv(E,E);let m=E[0],p=E[1],g=E[2];h=d.al(n[0],n[1],n[2]),d.VC(h,h,a),l=d.al(n[0],n[1],n[2]),d.VC(l,l,o);let T=Math.abs(l[0]*m+l[1]*p+l[2]*g),v=d.Ue();d.$X(v,l,d.bA(d.Ue(),E,T));let b=(v[0]*h[0]+v[1]*h[1]+v[2]*h[2])/(d.kE(v)*d.kE(h));b>1&&(b=1);let O=Math.acos(b),C=d.kC(d.Ue(),h,v);return T=m*C[0]+p*C[1]+g*C[2],O*(i!==tp.YAW_DELTA_BY_YAW?T>0?1:-1:T<0?1:-1)*_*x}_extractPitchFromQuat(t){let e=d.al(0,0,1);return d.VC(e,e,t),-1*Math.atan2(e[1],Math.sqrt(Math.pow(e[0],2)+Math.pow(e[2],2)))}constructor(){super(),this._onDeviceOrientation=t=>{let e=this._orientation,{alpha:i,beta:s,gamma:r}=t;null!=i&&null!=s&&null!=r&&(e.alpha=i,e.beta=s,e.gamma=r,this._orientationUpdated=!0,this._needsCalibrate&&(this._needsCalibrate=!1,this._calibrateSensor()))},this._updateScreenOrientation=()=>{window.screen&&window.screen.orientation&&void 0!==window.screen.orientation.angle?this._screenOrientation=screen.orientation.angle:void 0!==window.orientation?this._screenOrientation=window.orientation>=0?window.orientation:360+window.orientation:this._screenOrientation=0},this.quaternion=u.Ue(),this._orientation={alpha:0,beta:90,gamma:0},this._yawOrigin=0,this._yawOffset=0,this._orientationUpdated=!1,this._screenOrientation=0,this._needsCalibrate=!0,this._enabled=!1}}class tT extends _.Z{get enabled(){return this._input.enabled}get enableBlocked(){return this._enableBlocked}get animating(){return this._input.enabled&&this._input.orientationUpdated}get ignoreRoll(){return this._ignoreRoll}set ignoreRoll(t){this._ignoreRoll=t}static isAvailable(){return p(this,void 0,void 0,function*(){let t;return!!DeviceMotionEvent&&Promise.race([new Promise(e=>{t=t=>{e(t.rotationRate&&null!=t.rotationRate.alpha)},window.addEventListener(v.DEVICE_MOTION,t)}),new Promise(t=>{setTimeout(()=>t(!1),1e3)})]).then(e=>(window.removeEventListener(v.DEVICE_MOTION,t),e))})}static requestSensorPermission(){return p(this,void 0,void 0,function*(){return!ti()||DeviceMotionEvent.requestPermission().then(t=>"granted"===t).catch(()=>!1)})}destroy(){this.disable(),this._input.off(),this.off()}update(t,e,i,s){this._ignoreRoll?this._updateYawPitch(t,e,i,s):this._updateQuaternion(t,s)}enable(){this._input.enabled||(this._input.enable(),this._enableBlocked=!1,this.trigger(S.ENABLE,{control:this,updateCursor:!1}))}disable(){this._input.enabled&&(this._input.disable(),this.trigger(S.DISABLE,{updateCursor:!1}))}sync(){}_updateYawPitch(t,e,i,s){let r=this._input;if(!r.enabled)return;let{yaw:n,pitch:o}=r.collectDelta();e.add(n),i.add(o),t.lookAt({yaw:e.val,pitch:i.val,zoom:s})}_updateQuaternion(t,e){let i=this._input;i.enabled&&(i.update(),t.rotate(i.quaternion,e))}constructor(t,{ignoreRoll:e=!0}={}){super(),this._enableBlocked=t,this._ignoreRoll=e,this._input=new tg}}class tv{get useGrabCursor(){return this._useGrabCursor}set useGrabCursor(t){t===this._useGrabCursor||(this._useGrabCursor=t,t&&this._enabled?this._setCursor(O.GRAB):t||this._setCursor(O.NONE))}get disableContextMenu(){return this._disableContextMenu}set disableContextMenu(t){t===this._disableContextMenu||(this._disableContextMenu=t,t&&this._enabled?this._blockContextMenu():t||this._restoreContextMenu())}get scrollable(){return this._rotateControl.scrollable}set scrollable(t){this._rotateControl.scrollable=t}get wheelScrollable(){return this._zoomControl.scrollable}set wheelScrollable(t){this._zoomControl.scrollable=t}get ignoreZoomScale(){return this._ignoreZoomScale}set ignoreZoomScale(t){this._ignoreZoomScale=t}get enabled(){return this._enabled}get rotate(){return this._rotateControl}get zoom(){return this._zoomControl}get gyro(){return this._gyroControl}get animating(){return this._rotateControl.animating||this._zoomControl.animating||this._gyroControl.animating}destroy(){this.disable(),this._rotateControl.destroy(),this._zoomControl.destroy(),this._setCursor(O.NONE)}resize(t,e){let i=this._camera;this._rotateControl.resize(i.fov,i.aspect,t,e)}enable(){return p(this,void 0,void 0,function*(){this._enabled||(this._rotateControl.enableBlocked||this._rotateControl.enable(),this._zoomControl.enableBlocked||this._zoomControl.enable(),!this._gyroControl.enableBlocked&&(yield tT.isAvailable())&&this._gyroControl.enable(),this.sync(),this._disableContextMenu&&this._blockContextMenu(),this._enabled=!0)})}disable(){this._enabled&&(this._rotateControl.disable(),this._zoomControl.disable(),this._gyroControl.disable(),this._restoreContextMenu(),this._enabled=!1)}update(t){let e=this._camera,i=this._rotateControl,s=this._zoomControl,r=this._gyroControl;s.update(t);let n=ts(e.fov,s.zoom),o=this._ignoreZoomScale?1:Math.max(n,1);i.setZoomScale(o),i.updateRange(e,n),i.update(t);let a=i.yaw,l=i.pitch;r.enabled?r.update(e,a,l,n):e.lookAt({yaw:a.val,pitch:l.val,zoom:n})}sync(){let t=this._camera;this._zoomControl.sync(t),this._rotateControl.sync(t)}_blockContextMenu(){this._controlEl.addEventListener(v.CONTEXT_MENU,this._preventContextMenu)}_restoreContextMenu(){this._controlEl.removeEventListener(v.CONTEXT_MENU,this._preventContextMenu)}_setCursor(t){(this._useGrabCursor||t===O.NONE)&&(this._controlEl.style.cursor=t)}_bindEvents(){let t=this._rotateControl,e=this._zoomControl;t.on(S.INPUT_START,this._onInputStart),t.on(S.INPUT_END,this._onInputEnd),t.on(S.ENABLE,this._onEnable),t.on(S.DISABLE,this._onDisable),e.on(S.ENABLE,this._onEnable),e.on(S.DISABLE,this._onDisable),this._camera.on(y.ANIMATION_END,this._onCameraAnimationEnd)}constructor(t,e,{useGrabCursor:i,scrollable:s,wheelScrollable:r,disableContextMenu:n,rotate:o,zoom:a,gyro:l}){this._preventContextMenu=t=>{t.preventDefault()},this._onInputStart=t=>{this._useGrabCursor&&!t.isKeyboard&&this._setCursor(O.GRABBING)},this._onInputEnd=t=>{this._useGrabCursor&&!t.isKeyboard&&this._setCursor(O.GRAB)},this._onEnable=t=>{let{control:e,updateCursor:i}=t;i&&this._useGrabCursor&&this._setCursor(O.GRAB),e.sync(this._camera)},this._onDisable=t=>{let{updateCursor:e}=t;e&&this._setCursor(O.NONE)},this._onCameraAnimationEnd=t=>{let{animation:e}=t;e.getFinishPromise().then(()=>{this.sync()})},this._useGrabCursor=i,this._disableContextMenu=n,this._camera=e,this._controlEl=t,this._ignoreZoomScale=!1,this._enabled=!1,this._rotateControl=new td(t,!o,$(o)),this._zoomControl=new tm(t,!a,$(a)),this._gyroControl=new tT(!l,$(l)),this._rotateControl.scrollable=s,this._zoomControl.scrollable=r,this._bindEvents()}}class tb{destroy(){}isVideo(){return!1}isCube(){return!1}constructor({width:t,height:e,flipY:i}){this.width=t,this.height=e,this.flipY=i,this.wrapS=WebGLRenderingContext.CLAMP_TO_EDGE,this.wrapT=WebGLRenderingContext.CLAMP_TO_EDGE}}class tO extends tb{constructor({source:t,width:e,height:i,flipY:s}){super({width:e,height:i,flipY:s}),this.source=t}}class tC extends tO{destroy(){let t=this.source;t.pause(),t.removeAttribute("src"),t.load()}isVideo(){return!0}isPaused(){let t=this.source;return t.paused||t.ended||t.readyState<=2}hasAudio(){let t=this.source;return t.audioTracks?t.audioTracks.length>0:null!=t.webkitAudioDecodedByteCount?t.webkitAudioDecodedByteCount>0:null==t.mozHasAudio||t.mozHasAudio}}class tR extends tb{isCube(){return!0}constructor({sources:t,width:e,height:i,flipY:s}){super({width:e,height:i,flipY:s}),this.sources=t}}class tI{load(t,e){return p(this,void 0,void 0,function*(){if(e)return this.loadVideo(t,$(e));if(Array.isArray(t)&&t.length>1)return this.loadCubeImage(t);{let e=Array.isArray(t)?t[0]:t;return this.loadImage(e)}})}loadImage(t){return p(this,void 0,void 0,function*(){let e=this._toImageArray(t);return this._load(e,t=>{let i=e[0];t(new tO({source:i,width:i.naturalWidth,height:i.naturalHeight,flipY:!0}))})})}loadCubeImage(t){return p(this,void 0,void 0,function*(){let e=this._toImageArray(t);return this._load(e,t=>{t(new tR({sources:e,width:e[0].naturalWidth,height:e[0].naturalHeight,flipY:!1}))})})}loadVideo(t,e){return p(this,void 0,void 0,function*(){let i=Object.assign({autoplay:!0,muted:!0,loop:!1,volume:1},e),s=this._toVideoElement(t,i);return this._load([s],t=>{let{autoplay:e,muted:r}=i;s.currentTime=0,e&&r&&s.play().catch(()=>void 0),t(new tC({source:s,width:s.videoWidth,height:s.videoHeight,flipY:!0}))})})}_load(t,e){let i=this._loadChecker;return new Promise((s,r)=>{i.once("ready",t=>{t.errorCount>0||e(s)}),i.once("error",r),i.check(t)})}_toImageArray(t){return(Array.isArray(t)?t:[t]).map(t=>{if(!k(t))return t;{let e=new Image;return e.crossOrigin="anonymous",e.src=t,e}})}_toVideoElement(t,e){let{muted:i,loop:s,volume:r}=e;if(t instanceof HTMLVideoElement)return t;let n=document.createElement("video");return n.crossOrigin="anonymous",n.playsInline=!0,n.setAttribute("webkit-playsinline",""),n.muted=i,n.volume=r,n.loop=s,Array.isArray(t)?t.forEach(t=>this._appendSourceElement(n,t)):this._appendSourceElement(n,t),n.querySelectorAll("source").length>0&&n.readyState<1&&n.load(),n}_appendSourceElement(t,e){if(e instanceof HTMLSourceElement)return e;let i=document.createElement("source");i.src=e,t.appendChild(i)}constructor(){this._loadChecker=new m.ZP}}class tL{start(t){let e=this._context;if(!e||!t||this._rafId>=0||this._rafTimer>=0)return;let i=(s,r)=>{let n=Date.now();t(Math.min(n-this._lastUpdateTime,1e3*this.maxDeltaTime),r),this._lastUpdateTime=n,this._rafId=e.requestAnimationFrame(i)};this._lastUpdateTime=Date.now(),this._rafId=e.requestAnimationFrame(i)}stop(){this._rafId>=0&&this._context.cancelAnimationFrame(this._rafId),this._rafTimer>=0&&clearTimeout(this._rafTimer),this._rafId=-1,this._rafTimer=-1}changeContext(t){this.stop(),this._context=t}constructor(t,e=window){this.maxDeltaTime=t,this._context=e,this._rafId=-1,this._rafTimer=-1,this._lastUpdateTime=-1}}class tN{get useResizeObserver(){return this._useResizeObserver}get enabled(){return this._enabled}enable(t){if(this._enabled&&this.disable(),this._useResizeObserver&&window.ResizeObserver){let e=t.getBoundingClientRect(),i=0!==e.width||0!==e.height,s=new ResizeObserver(i?this._skipFirstResize:this._onResize);s.observe(t),this._resizeObserver=s}else window.addEventListener(v.RESIZE,this._onResize);return this._enabled=!0,this}disable(){if(!this._enabled)return this;let t=this._resizeObserver;return t?(t.disconnect(),this._resizeObserver=null):window.removeEventListener(v.RESIZE,this._onResize),this._enabled=!1,this}constructor(t,e){this._skipFirstResize=(()=>{let t=!0;return()=>{if(t){t=!1;return}this._onResize()}})(),this._useResizeObserver=t,this._enabled=!1,this._resizeObserver=null,this._onResize=e}}class tf{get enabled(){return this._enabled}get enableBlocked(){return this._enableBlocked}get playing(){return this._enabled&&!this._interrupted}get delay(){return this._delay}set delay(t){this._delay=t}get delayOnMouseLeave(){return this._delayOnMouseLeave}set delayOnMouseLeave(t){this._delayOnMouseLeave=t}get speed(){return this._speed}set speed(t){this._speed=t}get pauseOnHover(){return this._pauseOnHover}set pauseOnHover(t){this._pauseOnHover=t}get canInterrupt(){return this._canInterrupt}set canInterrupt(t){this._canInterrupt=t}get disableOnInterrupt(){return this._disableOnInterrupt}set disableOnInterrupt(t){this._disableOnInterrupt=t}destroy(){this.disable()}update(t){if(!this._enabled)return;if(this._interrupted){this._disableOnInterrupt&&this.disable();return}let e=this._camera,i=-this._speed*t/100;e.yaw=J(e.yaw+i,0,360)}enable(){let t=this._control,e=this._element;this._enabled||t.gyro.enabled||(t.rotate.on(S.INPUT_START,this._onInputStart),t.rotate.on(S.INPUT_END,this._onInputEnd),t.zoom.on(S.INPUT_START,this._onInputStart),t.zoom.on(S.INPUT_END,this._onInputEnd),t.gyro.on(S.ENABLE,this._onGyroEnable),e.addEventListener(v.MOUSE_ENTER,this._onMouseEnter,!1),e.addEventListener(v.MOUSE_LEAVE,this._onMouseLeave,!1),this._enabled=!0,this._enableBlocked=!1)}enableAfterDelay(){this.enable(),this._interrupted=!0,this._setUninterruptedAfterDelay(this._delay)}disable(){if(!this._enabled)return;let t=this._control,e=this._element;t.rotate.off(S.INPUT_START,this._onInputStart),t.rotate.off(S.INPUT_END,this._onInputEnd),t.zoom.off(S.INPUT_START,this._onInputStart),t.zoom.off(S.INPUT_END,this._onInputEnd),t.gyro.off(S.ENABLE,this._onGyroEnable),e.removeEventListener(v.MOUSE_ENTER,this._onMouseEnter,!1),e.removeEventListener(v.MOUSE_LEAVE,this._onMouseLeave,!1),this._enabled=!1,this._interrupted=!1,this._hovering=!1,this._clearTimeout()}_setUninterruptedAfterDelay(t){this._hovering||(this._clearTimeout(),t>0?this._interruptionTimer=window.setTimeout(()=>{this._interrupted=!1,this._interruptionTimer=-1},t):(this._interrupted=!1,this._interruptionTimer=-1))}_clearTimeout(){this._interruptionTimer>=0&&(window.clearTimeout(this._interruptionTimer),this._interruptionTimer=-1)}constructor(t,e,i){this._onInputStart=()=>{this._canInterrupt&&(this._interrupted=!0,this._clearTimeout())},this._onInputEnd=()=>{this._setUninterruptedAfterDelay(this._delay)},this._onGyroEnable=()=>{this.disable()},this._onMouseEnter=()=>{this._pauseOnHover&&(this._interrupted=!0,this._hovering=!0)},this._onMouseLeave=()=>{this._pauseOnHover&&(this._hovering=!1,this._setUninterruptedAfterDelay(this._delayOnMouseLeave))},this._camera=t.camera,this._control=t.control,this._element=e,this._enabled=!1,this._interrupted=!1,this._interruptionTimer=-1,this._hovering=!1;let{delay:s=2e3,delayOnMouseLeave:r=0,speed:n=1,pauseOnHover:o=!1,canInterrupt:a=!0,disableOnInterrupt:l=!1}=$(i);this._enableBlocked=!i,this._delay=s,this._delayOnMouseLeave=r,this._speed=n,this._pauseOnHover=o,this._canInterrupt=a,this._disableOnInterrupt=l}}class tA extends _.Z{isAvailable(){return p(this,void 0,void 0,function*(){let t=window.navigator.xr;return!!t&&t.isSessionSupported(G).then(t=>t).catch(()=>!1)})}enter(){return p(this,void 0,void 0,function*(){let t=this._ctx,e=window.navigator.xr;if(!e)return;yield tT.requestSensorPermission();let i=Object.assign({requiredFeatures:[H]},this._options);yield t.makeXRCompatible();let s=yield e.requestSession(G,i);t.bindXRLayer(s);let r=yield s.requestReferenceSpace(H);this._setSession(s,r),this.trigger(w.VR_START,{session:s})})}exit(){let t=this._xrSession;t&&t.end().catch(()=>void 0),this._xrSession=null,this._xrRefSpace=null}canRender(t){let e=this._xrRefSpace;return!!e&&!!t.getViewerPose(e)}getEyeParams(t){let e=t.session,i=t.getViewerPose(this._xrRefSpace);if(!i)return null;let s=e.renderState.baseLayer;return s?i.views.map(t=>({viewport:s.getViewport(t),vMatrix:t.transform.inverse.matrix,pMatrix:t.projectionMatrix})):null}_setSession(t,e){this._xrSession=t,this._xrRefSpace=e,t.addEventListener(v.XR_END,this._onSessionEnd)}constructor(t,e={}){super(),this.destroy=()=>{this.exit(),this.off()},this._onSessionEnd=()=>{this.exit(),this.trigger(w.VR_END)},this._xrSession=null,this._xrRefSpace=null,this._ctx=t,this._options=e}}class tw{constructor(t,e){this.element=t,this.position=e}}class ty{refresh(){let t=this._containerEl;if(!t)return;let e=[].slice.apply(t.querySelectorAll(".".concat(A.HOTSPOT)));this._hotspots=e.map(t=>this._parseHotspot(t))}render(t){let e=this._hotspots,i=.5*this._renderer.width,s=.5*this._renderer.height,r=t.zoom,n=this._zoom?"scale(".concat(r,")"):"";e.forEach(e=>{let r=e.position,o=d.Ue();if(d.JG(o,r),d.fF(o,o,t.viewMatrix),d.fF(o,o,t.projectionMatrix),o[2]>1||o[2]<0){e.element.classList.remove(A.HOTSPOT_VISIBLE);return}let a=E.al(o[0]*i+i,-o[1]*s+s);e.element.classList.add(A.HOTSPOT_VISIBLE),e.element.style.transform=["translate(-50%, -50%)","translate(".concat(a[0],"px, ").concat(a[1],"px)"),n].join(" ")})}_parseHotspot(t){let e=t.dataset.yaw,i=t.dataset.pitch,s=t.dataset.position;if(e||i){let s=e?parseFloat(e):0,r=i?parseFloat(i):0;return new tw(t,this._yawPitchToVec3(s,r))}if(!s)return new tw(t,d.al(0,0,-1));{let e=s.split(" ").map(t=>parseFloat(t));if(e.length<3)throw new g(T.MESSAGES.INSUFFICIENT_ARGS(s,'hotspot attribute "data-position"'),T.CODES.INSUFFICIENT_ARGS);return new tw(t,d.al(e[0],e[1],e[2]))}}_yawPitchToVec3(t,e){let i=t*D,s=e*D,r=d.Ue();return r[1]=Math.sin(s),r[2]=Math.cos(s),r[0]=r[2]*Math.sin(-i),r[2]=-r[2]*Math.cos(-i),r}constructor(t,e,{zoom:i=!1}){this._containerEl=K(".".concat(A.HOTSPOT_CONTAINER),t),this._renderer=e,this._hotspots=[],this._zoom=i}}class tS{get count(){return this.geometry.indicies.count}constructor(t,e,i){this.obj=t,this.geometry=e,this.buffers=i}}class tD{get canvas(){return this._canvas}get maxTextureSize(){return this._maxTextureSize}get isWebGL2(){return this._isWebGL2}get supportVAO(){return this._isWebGL2||!!this._extensions.vao}get lost(){return this._contextLost}get debug(){return this._debug}init(){let t=this._canvas,{gl:e,isWebGL2:i}=this._getContext(t);this._gl=e,this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._isWebGL2=i,this._isWebGL2||(this._extensions.vao=e.getExtension("OES_vertex_array_object")),this._extensions.loseContext=e.getExtension("WEBGL_lose_context"),t.addEventListener(v.CONTEXT_LOST,this._onContextLost),t.addEventListener(v.CONTEXT_RESTORED,this._onContextRestore)}destroy(){let t=this._gl,e=this._canvas;t&&(t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),e.removeEventListener(v.CONTEXT_LOST,this._onContextLost),e.removeEventListener(v.CONTEXT_RESTORED,this._onContextRestore)}forceLoseContext(){let t=this._extensions.loseContext;t&&t.loseContext()}forceRestoreContext(){let t=this._extensions.loseContext;t&&t.restoreContext()}clear(){let t=this._gl;t.clear(t.COLOR_BUFFER_BIT)}resize(){let t=this._gl;t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)}viewport(t,e,i,s){this._gl.viewport(t,e,i,s)}createVAO(t,e){let i=this._createNativeVAO(),s=new tS(i,t,{indicies:this._createBuffer(),position:this._createBuffer(),uv:this._createBuffer()});return i&&(this._bindNativeVAO(i),this._supplyGeometryData(s,e),this._bindNativeVAO(null),this._unbindBuffers()),s}draw(t,e){let i=this._gl;t.obj?this._bindNativeVAO(t.obj):this._supplyGeometryData(t,e),i.drawElements(i.TRIANGLES,t.count,i.UNSIGNED_SHORT,0),t.obj?this._bindNativeVAO(null):this._unbindBuffers()}releaseVAO(t){t.obj&&this._deleteNativeVAO(t.obj),this._deleteBuffer(t.buffers.indicies),this._deleteBuffer(t.buffers.position),this._deleteBuffer(t.buffers.uv)}getUniformLocations(t,e){let i=this._gl,s=Object.keys(e).reduce((e,s)=>(e[s]=i.getUniformLocation(t,s),e),{});return Object.assign(Object.assign({},this._getCommonUniformLocations(t)),s)}updateCommonUniforms(t,e,i){let s=this._gl,r=i.uniformLocations,n=t.matrix,o=c.Ue();c.Jp(o,e.viewMatrix,n),s.uniformMatrix4fv(r.uMVMatrix,!1,o),s.uniformMatrix4fv(r.uPMatrix,!1,e.projectionMatrix)}updateVRUniforms(t,e,i,s){let r=this._gl,n=t.uniformLocations;r.uniformMatrix4fv(n.uMVMatrix,!1,e),r.uniformMatrix4fv(n.uPMatrix,!1,i),n.uEye&&r.uniform1f(n.uEye,s)}updateUniforms(t){let e=this._gl,i=t.uniforms,s=t.uniformLocations;for(let t in i){let r=i[t],n=s[t];r&&r.needsUpdate&&r.update(e,n,this._isWebGL2)}}releaseShaderResources(t){let e=this._gl,i=t.uniforms;for(let t in i){let s=i[t];s&&s.needsUpdate&&s.destroy(e)}e.deleteProgram(t.program)}useProgram(t){this._gl.useProgram(t.program)}createProgram(t,e){let i=this._gl,s=i.createProgram(),r=this._compileShader(i.VERTEX_SHADER,t),n=this._compileShader(i.FRAGMENT_SHADER,e);if(i.attachShader(s,r),i.attachShader(s,n),i.bindAttribLocation(s,0,"position"),i.bindAttribLocation(s,1,"uv"),i.linkProgram(s),this._debug&&!i.getProgramParameter(s,i.LINK_STATUS)){let t=null;throw i.getShaderParameter(r,i.COMPILE_STATUS)?i.getShaderParameter(n,i.COMPILE_STATUS)||(t=i.getShaderInfoLog(n)):t=i.getShaderInfoLog(r),new g(T.MESSAGES.FAILED_LINKING_PROGRAM(i.getProgramInfoLog(s),t),T.CODES.FAILED_LINKING_PROGRAM)}return i.deleteShader(r),i.deleteShader(n),s}createWebGLTexture(t){let e=this._gl,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapS),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapT),!t.isVideo()&&this._isWebGL2&&e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8,t.width,t.height),i}createWebGLCubeTexture(t,e){let i=this._gl,s=i.createTexture();return i.bindTexture(i.TEXTURE_CUBE_MAP,s),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,t.wrapS),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,t.wrapT),this._isWebGL2&&i.texStorage2D(i.TEXTURE_CUBE_MAP,1,i.RGBA8,e,e),s}makeXRCompatible(){return p(this,void 0,void 0,function*(){let t=this._gl,e=t.getContextAttributes();e&&!0!==e.xrCompatible&&(yield t.makeXRCompatible())})}bindXRLayer(t){let e=this._gl,i=new XRWebGLLayer(t,e);t.updateRenderState({baseLayer:i})}bindXRFrame(t){let e=this._gl,i=t.session.renderState.baseLayer;e.bindFramebuffer(e.FRAMEBUFFER,i.framebuffer)}useDefaultFrameBuffer(){let t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null)}_createBuffer(){return this._gl.createBuffer()}_deleteBuffer(t){return this._gl.deleteBuffer(t)}_createNativeVAO(){let t=this._gl;if(this._isWebGL2)return t.createVertexArray();{let t=this._extensions.vao;return(null==t?void 0:t.createVertexArrayOES())||null}}_bindNativeVAO(t){let e=this._gl;if(this._isWebGL2)e.bindVertexArray(t);else{let e=this._extensions.vao;null==e||e.bindVertexArrayOES(t)}}_deleteNativeVAO(t){let e=this._gl;if(this._isWebGL2)e.deleteVertexArray(t);else{let e=this._extensions.vao;null==e||e.deleteVertexArrayOES(t)}}_supplyGeometryData(t,e){let i=t.geometry;this._supplyIndiciesData(i.indicies,t.buffers.indicies),this._supplyAttributeData(i.vertices,e.program,"position",t.buffers.position),this._supplyAttributeData(i.uvs,e.program,"uv",t.buffers.uv)}_unbindBuffers(){let t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindBuffer(t.ARRAY_BUFFER,null)}_supplyIndiciesData(t,e){let i=this._gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.data,i.STATIC_DRAW)}_supplyAttributeData(t,e,i,s){let r=this._gl,n=r.getAttribLocation(e,i);n<0||(r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,t.data,r.STATIC_DRAW),r.vertexAttribPointer(n,t.itemSize,r.FLOAT,!1,0,0),r.enableVertexAttribArray(n))}_compileShader(t,e){let i=this._gl,s=i.createShader(t);return i.shaderSource(s,e),i.compileShader(s),s}_getCommonUniformLocations(t){let e=this._gl;return{uMVMatrix:e.getUniformLocation(t,"uMVMatrix"),uPMatrix:e.getUniformLocation(t,"uPMatrix")}}_getContext(t){let e=null,i=!1,s={preserveDrawingBuffer:!1,antialias:!1},r=t=>t.statusMessage;for(let n of(t.addEventListener(v.CONTEXT_CREATE_ERROR,r),["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"])){try{e=t.getContext(n,s),i="webgl2"===n}catch(t){}if(e)break}if(t.removeEventListener(v.CONTEXT_CREATE_ERROR,r),!e)throw new g(T.MESSAGES.WEBGL_NOT_SUPPORTED,T.CODES.WEBGL_NOT_SUPPORTED);return{gl:e,isWebGL2:i}}constructor(t,e){this._onContextLost=()=>{this._canvas.classList.add(A.CTX_LOST),this._contextLost=!0},this._onContextRestore=()=>{this._canvas.classList.remove(A.CTX_LOST),this._contextLost=!1},this._canvas=t,this._contextLost=!1,this._debug=e,this._extensions={vao:null,loseContext:null}}}class tx{get canvas(){return this._canvas}get width(){return this._elementSize.x}get height(){return this._elementSize.y}get pixelRatio(){return this._pixelRatio}get aspect(){return this._elementSize.x/this._elementSize.y}destroy(){let t=this._canvas;this.ctx.destroy(),t.width=1,t.height=1}resize(){let t=this._canvas,e=this._elementSize,i=window.devicePixelRatio;e.x=t.clientWidth,e.y=t.clientHeight,t.width=e.x*i,t.height=e.y*i,this._pixelRatio=i,this.ctx.resize()}render(t,e){let i=this.ctx;i.lost||(i.clear(),i.useProgram(t.program),i.updateCommonUniforms(t,e,t.program),t.update({camera:e}),i.updateUniforms(t.program),i.draw(t.vao,t.program))}renderVR(t,e,i){let s=this.ctx,r=e.getEyeParams(i);r&&t&&(s.bindXRFrame(i),s.useProgram(t.program),s.updateUniforms(t.program),r.forEach((e,i)=>{let r=e.viewport,n=c.Jp(c.Ue(),e.vMatrix,t.matrix);s.viewport(r.x,r.y,r.width,r.height),s.updateVRUniforms(t.program,n,e.pMatrix,i),s.draw(t.vao,t.program)}))}constructor(t,e){this._canvas=t,this._elementSize={x:0,y:0},this._pixelRatio=1,this.ctx=new tD(t,e)}}class tP extends _.Z{get rootEl(){return this._rootEl}get renderer(){return this._renderer}get camera(){return this._camera}get control(){return this._control}get vr(){return this._vr}get hotspot(){return this._hotspot}get plugins(){return this._plugins}get projection(){return this._projection}set projection(t){this._initialized&&t?this.load(t):this._projection=t}get mesh(){return this._mesh}get initialized(){return this._initialized}get autoplay(){return this._autoplay}get autoInit(){return this._autoInit}get autoResize(){return this._autoResize}get canvasSelector(){return this._canvasSelector}get useResizeObserver(){return this._useResizeObserver}get tabIndex(){return this._tabIndex}set tabIndex(t){let e=this._renderer.canvas;this._tabIndex=t,null!=t?e.tabIndex=t:e.removeAttribute("tabindex")}get maxDeltaTime(){return this._animator.maxDeltaTime}set maxDeltaTime(t){this._animator.maxDeltaTime=t}get debug(){return this._debug}set debug(t){this._debug=t}get initialYaw(){return this._camera.initialYaw}set initialYaw(t){this._camera.initialYaw=t}get initialPitch(){return this._camera.initialPitch}set initialPitch(t){this._camera.initialPitch=t}get initialZoom(){return this._camera.initialZoom}set initialZoom(t){this._camera.initialZoom=t}get yawRange(){return this._camera.yawRange}set yawRange(t){this._camera.yawRange=t,this._projection&&this._projection.updateCamera(this._camera)}get pitchRange(){return this._camera.pitchRange}set pitchRange(t){this._camera.pitchRange=t,this._projection&&this._projection.updateCamera(this._camera)}get zoomRange(){return this._camera.zoomRange}set zoomRange(t){this._camera.zoomRange=t,this._projection&&this._projection.updateCamera(this._camera)}get fov(){return this._camera.fov}set fov(t){let e=this._camera,i=this._control;e.fov=t,e.updateMatrix(),i.sync()}get rotate(){return this._control.rotate}get zoom(){return this._control.zoom}get gyro(){return this._control.gyro}get useGrabCursor(){return this._control.useGrabCursor}set useGrabCursor(t){this._control.useGrabCursor=t}get disableContextMenu(){return this._control.disableContextMenu}set disableContextMenu(t){this._control.disableContextMenu=t}get scrollable(){return this._control.scrollable}set scrollable(t){this._control.scrollable=t}get wheelScrollable(){return this._control.wheelScrollable}set wheelScrollable(t){this._control.wheelScrollable=t}destroy(){this._camera.destroy(),this._animator.stop(),this._renderer.destroy(),this._control.destroy(),this._autoResizer.disable(),this._mesh&&(this._mesh.destroy(this._renderer.ctx),this._mesh=null),this._plugins.forEach(t=>t.destroy(this)),this._initialized=!1}init(){return p(this,void 0,void 0,function*(){if(!this._projection)throw new g(T.MESSAGES.PROVIDE_PROJECTION_FIRST,T.CODES.PROVIDE_PROJECTION_FIRST);let t=this._renderer,e=this._camera,i=this._control,s=this._animator,r=this._hotspot,n=this._projection,o=t.canvas;this._bindComponentEvents(),t.ctx.init(),this._resizeComponents(),e.updateMatrix(),this._autoResize&&this._autoResizer.enable(o),this._autoplay.enableBlocked||this._autoplay.enable(),this._plugins.forEach(t=>{t.init(this)});let a=yield this._loadTexture(n);this._applyProjection(n,a),r.refresh(),s.start(this._renderFrameOnDemand),yield i.enable(),null==this._tabIndex||o.hasAttribute("tabIndex")||(o.tabIndex=this._tabIndex),this._initialized=!0,this.renderFrame(0),this._emit(w.READY)})}load(t){return p(this,void 0,void 0,function*(){if(!t)return!1;if(this._initialized){let e=yield this._loadTexture(t);this._applyProjection(t,e),this.renderFrame(0)}else this._projection=t,this.init();return!0})}resize(){if(!this._initialized)return;this._resizeComponents(),this.renderFrame(0);let{width:t,height:e}=this._renderer;this._emit(w.RESIZE,{width:t,height:e})}addPlugins(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];this._initialized&&e.forEach(t=>{t.init(this)}),this._plugins.push(...e)}removePlugins(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach(t=>{let e=this._plugins.indexOf(t);e<0||(t.destroy(this),this._plugins.splice(e,1))})}_emit(t){for(var e=arguments.length,i=Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];let r=i?i[0]:{};this.trigger(t,Object.assign({type:t,target:this},r))}_applyProjection(t,e){let i=this._camera,s=this._control,r=this._renderer,n=this._mesh;n&&n.destroy(r.ctx);let o=t.createMesh(r.ctx,e);t.updateCamera(i),t.updateControl(s),this._mesh=o,this._emit(w.PROJECTION_CHANGE,{projection:t})}_loadTexture(t){return p(this,void 0,void 0,function*(){let e=new tI,{src:i,video:s}=t;this._emit(w.LOAD_START,{src:i,video:s});let r=yield e.load(i,s);return this._emit(w.LOAD,{src:i,video:s}),r})}_resizeComponents(){let t=this._renderer,e=this._camera,i=this._control;t.resize(),e.resize(t.width,t.height),i.resize(t.width,t.height)}_addEventHandlers(t){Object.keys(t).forEach(e=>{this.on(e,t[e])})}_bindComponentEvents(){let t=this._rootEl,e=this._control,i=this._animator,s=this._renderer,r=this._vr;[S.STATIC_CLICK,S.INPUT_START,S.INPUT_END].forEach(t=>{e.rotate.on(t,e=>{this._emit(t,e)}),e.zoom.on(t,e=>{this._emit(t,e)})}),r.on(w.VR_START,e=>{t.classList.add(A.IN_VR),i.changeContext(e.session),i.start(this._renderVRFrame),this._emit(w.VR_START)}),r.on(w.VR_END,()=>{t.classList.remove(A.IN_VR),s.ctx.useDefaultFrameBuffer(),i.changeContext(window),i.start(this._renderFrameOnDemand),this.resize(),this._emit(w.VR_END)})}constructor(t,{projection:e=null,initialYaw:i=0,initialPitch:s=0,initialZoom:r=1,yawRange:n=null,pitchRange:o=null,zoomRange:a=null,fov:l=90,useGrabCursor:h=!0,disableContextMenu:_=!1,rotate:u=!0,zoom:d=!0,gyro:c=!1,scrollable:E=!0,wheelScrollable:m=!1,autoplay:p=!1,hotspot:g={},autoInit:T=!0,autoResize:v=!0,canvasSelector:b="canvas",useResizeObserver:O=!0,on:C={},plugins:R=[],maxDeltaTime:I=1/30,tabIndex:L=0,debug:N=!1}={}){super(),this.renderFrame=t=>{let e=this._camera,i=this._renderer,s=this._control,r=this._hotspot,n=this._autoplay,o=this._mesh;o&&(this._emit(w.BEFORE_RENDER),n.playing&&(n.update(t),s.sync()),e.animation?e.animation.update(t):s.update(t),i.render(o,e),r.render(e),e.changed&&this._emit(w.VIEW_CHANGE,{yaw:e.yaw,pitch:e.pitch,zoom:e.zoom,quaternion:[e.quaternion[0],e.quaternion[1],e.quaternion[2],e.quaternion[3]]}),e.onFrameRender(),this._emit(w.RENDER))},this._renderFrameOnDemand=t=>{let e=this._camera,i=this._control,s=this._autoplay,r=this._mesh,n=null==r?void 0:r.getTexture();this._initialized&&n&&(e.animation||i.animating||s.playing||n.isVideo())&&this.renderFrame(t)},this._renderVRFrame=(t,e)=>{let i=this._vr,s=this._mesh,r=this._renderer;s&&(this._emit(w.BEFORE_RENDER),r.renderVR(s,i,e),this._emit(w.RENDER))},this._rootEl=X(t),this._plugins=R,this._initialized=!1,this._autoInit=T,this._autoResize=v,this._canvasSelector=b,this._useResizeObserver=O,this._tabIndex=L,this._debug=N;let f=j(this._rootEl,b);this._renderer=new tx(f,N),this._camera=new tl({initialYaw:i,initialPitch:s,initialZoom:r,fov:l,yawRange:n,pitchRange:o,zoomRange:a}),this._control=new tv(f,this._camera,{useGrabCursor:h,scrollable:E,wheelScrollable:m,disableContextMenu:_,rotate:u,zoom:d,gyro:c}),this._animator=new tL(I),this._autoplay=new tf(this,f,p),this._projection=e,this._mesh=null,this._autoResizer=new tN(O,()=>this.resize()),this._vr=new tA(this._renderer.ctx),this._hotspot=new ty(this._rootEl,this._renderer,g),this._addEventHandlers(C),e&&T&&this.init()}}tP.VERSION="4.0.0-beta.7";class tU extends _.Z{updateMatrix(){c.Iw(this.matrix,this.rotation,this.position,this.scale)}update(t){this.trigger("update",t)}constructor(){super(),this.matrix=c.Ue(),this.rotation=u.Ue(),this.position=d.al(0,0,0),this.scale=d.al(1,1,1)}}class tM{init(t){t.on(w.LOAD_START,this._startLoading)}destroy(t){t.off(w.LOAD_START,this._startLoading),this._detachElements({target:t})}_createElements(){let t=Object.assign(Object.assign({},this.className),tM.DEFAULT_CLASS),e=W(t.CONTAINER),i=W(t.RING);return e.appendChild(i),e}constructor({className:t={}}={}){this._startLoading=t=>{let{target:e}=t;e.rootEl.appendChild(this._container),e.initialized?e.once(w.LOAD,this._detachElements):e.once(w.READY,this._detachElements)},this._detachElements=t=>{let{target:e}=t,i=this._container;i&&i.parentElement===e.rootEl&&e.rootEl.removeChild(i)},this.className=t,this._container=this._createElements()}}tM.DEFAULT_CLASS={CONTAINER:"view360-spinner",RING:"view360-spinner-ring"};class tB{constructor(t){this.position=t.position,this.order=t.order}}let tF={CONTROLS_ROOT:"view360-controls",CONTROLS_BG:"view360-controls-background",CONTROLS_MAIN:"view360-controls-main",CONTROLS_TOP:"view360-controls-top",CONTROLS_BOTTOM:"view360-controls-bottom",CONTROLS_MID:"view360-controls-mid",CONTROLS_LEFT:"view360-controls-left",CONTROLS_RIGHT:"view360-controls-right",CONTROLS_FLOAT_LEFT:"view360-controls-float-left",CONTROLS_FLOAT_RIGHT:"view360-controls-float-right",CONTROLS_BUTTON:"view360-controls-button",PROGRESS_ROOT:"view360-controls-progress",VOLUME_ROOT:"view360-controls-volume",RANGE_ROOT:"view360-range",RANGE_TRACK:"view360-range-track",RANGE_THUMB:"view360-range-thumb",RANGE_FILLER:"view360-range-filler",PLAY_BUTTON:"view360-controls-play",PAUSE_BUTTON:"view360-controls-pause",UNMUTED_BUTTON:"view360-controls-unmuted",MUTED_BUTTON:"view360-controls-muted",FULLSCREEN_BUTTON:"view360-controls-fullscreen",FULLSCREEN_EXIT_BUTTON:"view360-controls-fullscreen-exit",VR_BUTTON:"view360-controls-vr",GYRO_ENABLED:"view360-controls-gyro-enabled",GYRO_DISABLED:"view360-controls-gyro-disabled",VIDEO_TIME_DISPLAY:"view360-controls-time",PIEVIEW_ROOT:"view360-controls-pie",FIXED:"view360-controls-fixed",UNAVAILABLE:"view360-controls-unavailable",HIDDEN:"view360-controls-hidden"},tV={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",MAIN_TOP:"main-top",MAIN_BOTTOM:"main-bottom",MAIN_LEFT:"main-left",MAIN_RIGHT:"main-right"};class tG extends _.Z{init(t){let e=this._mouseInput,i=this._touchInput;this.rootEl.classList.add(t.RANGE_ROOT),this.trackEl.classList.add(t.RANGE_TRACK),this.thumbEl.classList.add(t.RANGE_THUMB),this.fillerEl.classList.add(t.RANGE_FILLER),this._fixedClass=t.FIXED,e.on(S.INPUT_START,this._onHold),i.on(S.INPUT_START,this._onHold),e.on(S.INPUT_END,this._onRelease),i.on(S.INPUT_END,this._onRelease),e.on(S.CHANGE,this._onChange),i.on(S.CHANGE,this._onChange),e.enable(this.rootEl),i.enable(this.rootEl),this.resize()}destroy(){let t=this._mouseInput,e=this._touchInput;this.rootEl.className="",this.trackEl.className="",this.thumbEl.className="",this.fillerEl.className="",t.off(),e.off(),t.disable(),e.disable()}resize(){this._bbox=this.trackEl.getBoundingClientRect()}updateStyle(t){let e=this._bbox.width,i=Z(t,0,1);this.fillerEl.style.width="".concat(100*i,"%"),this.thumbEl.style.transform="translateX(".concat(i*e,"px)")}constructor(){super(),this._onHold=t=>{var e;let{srcEvent:i,isTouch:s}=t,r=this._bbox;if(!r)return;let n=s?i.touches[0].pageX:i.pageX,o=r.x+(null!==(e=window.scrollX)&&void 0!==e?e:window.pageXOffset),a=Z(n,o,o+r.width),l=(a-o)/r.width;this._motion.reset(a),this.thumbEl.classList.add(this._fixedClass),this.trigger(S.INPUT_START,l)},this._onChange=t=>{var e;let{delta:i}=t,s=this._motion,r=this._bbox;if(!r)return;s.setNewEndByDelta(i.x),s.update(1);let n=r.x+(null!==(e=window.scrollX)&&void 0!==e?e:window.pageXOffset),o=(Z(s.val,n,n+r.width)-n)/r.width;this.trigger(S.CHANGE,o)},this._onRelease=()=>{this._bbox&&(this.thumbEl.classList.remove(this._fixedClass),this.trigger(S.INPUT_END))};let t=document.createElement("div"),e=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div");t.draggable=!1,e.appendChild(s),e.appendChild(i),t.appendChild(e),this.rootEl=t,this.trackEl=e,this.thumbEl=i,this.fillerEl=s,this._mouseInput=new th,this._touchInput=new t_,this._motion=new to({duration:1,range:U,easing:t=>t}),this._bbox={x:0,y:0,width:0,height:0,left:0,right:0,bottom:0,top:0},this._fixedClass=tF.FIXED}}class tH extends tB{get element(){return this._rangeControl.rootEl}init(t,e){var i;let s=null===(i=t.mesh)||void 0===i?void 0:i.getTexture(),r=this.element,n=this._rangeControl,o=e.className.UNAVAILABLE;if(!s||!s.isVideo()){r.classList.add(o);return}r.classList.remove(o),r.classList.add(e.className.PROGRESS_ROOT),t.on(w.RESIZE,this._onResize),s.source.addEventListener(v.VIDEO_TIME_UPDATE,this._onTimeUpdate),s.source.addEventListener(v.VIDEO_DURATION_CHANGE,this._onDurationChange),s.source.addEventListener(F,this._onTimeUpdate),n.init(e.className),n.on(S.INPUT_START,this._onHold),n.on(S.CHANGE,this._onControl),n.on(S.INPUT_END,this._onRelease),this._video=s,this._currentTime=s.source.currentTime,this._duration=s.source.duration,this._controlBar=e,n.updateStyle(this._currentTime/this._duration)}destroy(t){let e=this._video;t.off(w.RESIZE,this._onResize),e&&(e.source.removeEventListener(v.VIDEO_TIME_UPDATE,this._onTimeUpdate),e.source.removeEventListener(v.VIDEO_DURATION_CHANGE,this._onDurationChange),e.source.removeEventListener(F,this._onTimeUpdate)),this._rangeControl.destroy(),this._video=null,this._playPromise=null}constructor({position:t=tV.MAIN_TOP,order:e=9999}={}){super({position:t,order:e}),this._onResize=()=>{this._rangeControl.resize()},this._onTimeUpdate=()=>{let t=this._video;t&&(this._currentTime=t.source.currentTime,this._rangeControl.updateStyle(this._currentTime/this._duration))},this._onDurationChange=()=>{let t=this._video;t&&(this._duration=t.source.duration,this._rangeControl.updateStyle(this._currentTime/this._duration))},this._onHold=t=>{let e=this._video,i=this._controlBar;if(!e||!i)return;let s=e.isPaused();e.source.pause();let r=e.source.duration*t;e.source.currentTime=r,e.source.dispatchEvent(new CustomEvent(F,{detail:{time:r}})),i.rootEl.classList.add(i.className.FIXED),this._wasPaused=!this._playPromise&&s},this._onControl=t=>{let e=this._video;if(!e)return;let i=e.source.duration*t;e.source.currentTime=i,e.source.dispatchEvent(new CustomEvent(F,{detail:{time:i}}))},this._onRelease=()=>{let t=this._video,e=this._controlBar;t&&e&&!this._wasPaused&&!this._playPromise&&(this._playPromise=t.source.play().catch(()=>void 0),this._playPromise.then(()=>{this._playPromise=null}),e.rootEl.classList.remove(e.className.FIXED)),this._wasPaused=!1},this.position=t,this.order=e,this._controlBar=null,this._rangeControl=new tG,this._video=null,this._wasPaused=!1,this._currentTime=0,this._duration=0,this._playPromise=null}}class tz extends tB{init(t,e){var i;let s=this.element,r=null===(i=t.mesh)||void 0===i?void 0:i.getTexture(),n=e.className,o=n.UNAVAILABLE;if(!r||!r.isVideo()){s.classList.add(o);return}s.classList.add(n.CONTROLS_BUTTON),s.classList.remove(o);let a=r.isPaused();this._video=r,this._paused=a,this._controlBar=e,a?this._onPause():this._onPlay(),s.addEventListener(v.CLICK,this._onClick),r.source.addEventListener(v.VIDEO_PLAY,this._onPlay),r.source.addEventListener(v.VIDEO_PAUSE,this._onPause)}destroy(){let t=this._video,e=this.element;t&&(e.className="",e.removeEventListener(v.CLICK,this._onClick),t.source.removeEventListener(v.VIDEO_PLAY,this._onPlay),t.source.removeEventListener(v.VIDEO_PAUSE,this._onPause),this._video=null,this._paused=!0,this._controlBar=null)}constructor({position:t=tV.MAIN_LEFT,order:e=9999}={}){super({position:t,order:e}),this._onClick=()=>{let t=this._video;t&&(this._paused?t.source.play():t.source.pause())},this._onPlay=()=>{if(!this._controlBar)return;let t=this.element,e=this._controlBar.className;t.classList.add(e.PAUSE_BUTTON),t.classList.remove(e.PLAY_BUTTON),t.title="Pause Video",this._paused=!1},this._onPause=()=>{if(!this._controlBar)return;let t=this.element,e=this._controlBar.className;t.classList.add(e.PLAY_BUTTON),t.classList.remove(e.PAUSE_BUTTON),t.title="Play Video",this._paused=!0},this.element=document.createElement(b),this._video=null,this._paused=!0,this._controlBar=null}}class tk extends tB{get element(){return this._rootEl}init(t,e){var i;let s=null===(i=t.mesh)||void 0===i?void 0:i.getTexture(),r=this._rootEl,n=this._buttonEl,o=this._rangeControl,a=e.className,l=a.UNAVAILABLE;if(!s||!s.isVideo()){r.classList.add(l);return}r.classList.remove(l),r.classList.add(a.CONTROLS_BUTTON),r.classList.add(a.VOLUME_ROOT),n.classList.add(a.CONTROLS_BUTTON),s.source.muted?n.classList.add(a.MUTED_BUTTON):n.classList.add(a.UNMUTED_BUTTON),t.on(w.RESIZE,this._onResize),r.addEventListener(v.TRANSITION_END,this._onResize),n.addEventListener(v.CLICK,this._onClick),s.source.addEventListener(v.VIDEO_VOLUME_CHANGE,this._onVolumeChange),s.source.addEventListener(v.VIDEO_LOADED_DATA,this._updateDisplay),s.source.addEventListener(v.VIDEO_CAN_PLAYTHROUGH,this._updateDisplay),o.init(a),o.on(S.INPUT_START,this._onHold),o.on(S.CHANGE,this._onChange),o.on(S.INPUT_END,this._onRelease),this._controlBar=e,this._video=s,this._updateDisplay()}destroy(t){let e=this._video,i=this._buttonEl,s=this._rootEl;s.className="",i.className="",t.off(w.RESIZE,this._onResize),s.removeEventListener(v.TRANSITION_END,this._onResize),i.removeEventListener(v.CLICK,this._onClick),e&&(e.source.removeEventListener(v.VIDEO_VOLUME_CHANGE,this._onVolumeChange),e.source.removeEventListener(v.VIDEO_LOADED_DATA,this._updateDisplay),e.source.removeEventListener(v.VIDEO_CAN_PLAYTHROUGH,this._updateDisplay)),this._controlBar=null,this._rangeControl.destroy(),this._video=null}_createElements(){let t=document.createElement(b),e=document.createElement("div");t.appendChild(this._rangeControl.rootEl),t.appendChild(e),t.title="Toggle Mute",this._rootEl=t,this._buttonEl=e}constructor({position:t=tV.MAIN_RIGHT,order:e=9999}={}){super({position:t,order:e}),this._onResize=()=>{this._rangeControl.resize(),this._updateDisplay()},this._onClick=()=>{let t=this._video;t&&!this._rootEl.disabled&&(t.source.muted=!t.source.muted)},this._onVolumeChange=()=>{let t=this._buttonEl,e=this._video,i=this._controlBar;if(!e||!i)return;let s=i.className;e.source.muted||0===e.source.volume?(t.classList.add(s.MUTED_BUTTON),t.classList.remove(s.UNMUTED_BUTTON)):(t.classList.add(s.UNMUTED_BUTTON),t.classList.remove(s.MUTED_BUTTON)),this._updateDisplay()},this._onHold=t=>{let e=this._video,i=this._controlBar;if(!e||!i)return;let s=i.className;e.source.volume=t,this._rootEl.classList.add(s.FIXED),i.containerEl.classList.add(s.FIXED),this._updateDisplay()},this._onChange=t=>{let e=this._video;e&&(e.source.volume=t,t>0?e.source.muted=!1:e.source.muted=!0,this._updateDisplay())},this._onRelease=()=>{let t=this._controlBar;if(!t)return;let e=t.className;this._rootEl.classList.remove(e.FIXED),t.containerEl.classList.remove(e.FIXED)},this._updateDisplay=()=>{let t=this._video,e=this._rootEl;if(!t)return;if(!t.hasAudio()){e.disabled=!0;return}e.disabled=!1;let i=t.source.muted?0:t.source.volume;this._rangeControl.updateStyle(i)},this._controlBar=null,this._rangeControl=new tG,this._createElements(),this._video=null}}class tY extends tB{init(t,e){let i=this.element,s=e.className;if(!this._fullscreenAvailable()){i.classList.add(s.UNAVAILABLE);return}i.classList.add(s.CONTROLS_BUTTON),i.classList.remove(s.UNAVAILABLE),i.addEventListener(v.CLICK,this._onClick),this._addFullscreenHandlers(),te()?i.classList.add(s.FULLSCREEN_EXIT_BUTTON):i.classList.add(s.FULLSCREEN_BUTTON),this._controlBar=e,this._targetEl=t.rootEl}destroy(){let t=this.element;t.className="",t.removeEventListener(v.CLICK,this._onClick),this._removeFullscreenHandlers(),this._controlBar=null,this._targetEl=null}_fullscreenAvailable(){return I.some(t=>!!document[t])}_requestFullscreen(t){for(let e of I){let i=t[e];if(i){i.call(t);return}}}_exitFullscreen(){for(let t of N){let e=document[t];if(e){e.call(document);return}}}_addFullscreenHandlers(){f.forEach(t=>{document.addEventListener(t,this._onFullscreenChange)})}_removeFullscreenHandlers(){f.forEach(t=>{document.removeEventListener(t,this._onFullscreenChange)})}constructor({position:t=tV.MAIN_RIGHT,order:e=9999}={}){super({position:t,order:e}),this._onClick=()=>{let t=this._targetEl;t&&(te()?this._exitFullscreen():this._requestFullscreen(t))},this._onFullscreenChange=()=>{let t=this.element,e=this._controlBar;if(!e)return;let i=e.className;te()?(t.classList.add(i.FULLSCREEN_EXIT_BUTTON),t.classList.remove(i.FULLSCREEN_BUTTON)):(t.classList.add(i.FULLSCREEN_BUTTON),t.classList.remove(i.FULLSCREEN_EXIT_BUTTON))},this.element=document.createElement(b),this.element.title="Toggle Fullscreen",this._controlBar=null,this._targetEl=null}}class tW extends tB{init(t,e){var i;let s=null===(i=t.mesh)||void 0===i?void 0:i.getTexture(),r=this.element,n=e.className;if(!s||!s.isVideo()){r.classList.add(n.UNAVAILABLE);return}r.classList.add(n.VIDEO_TIME_DISPLAY),r.classList.remove(n.UNAVAILABLE),s.source.addEventListener(v.VIDEO_TIME_UPDATE,this._onTimeUpdate),s.source.addEventListener(v.VIDEO_DURATION_CHANGE,this._onDurationChange),s.source.addEventListener(F,this._onCustomTimeChange),this._video=s,this._currentTime=s.source.currentTime,this._duration=s.source.duration,this._updateDisplay()}destroy(){let t=this._video;t&&(this.element.className="",t.source.removeEventListener(v.VIDEO_TIME_UPDATE,this._onTimeUpdate),t.source.removeEventListener(v.VIDEO_DURATION_CHANGE,this._onDurationChange),t.source.removeEventListener(F,this._onCustomTimeChange),this._video=null)}_updateDisplay(){let t=this._currentTime,e=Math.floor(t/60),i=Math.floor(t-60*e),s=this._duration,r=Math.floor(s/60),n=Math.floor(s-60*r);this.element.innerText="".concat(e,":").concat(i<10?"0".concat(i):i," / ").concat(r,":").concat(n<10?"0".concat(n):n)}constructor({position:t=tV.MAIN_LEFT,order:e=9999}={}){super({position:t,order:e}),this._onTimeUpdate=()=>{let t=this._video;t&&(this._currentTime=t.source.currentTime,this._updateDisplay())},this._onDurationChange=()=>{let t=this._video;t&&(this._duration=t.source.duration,this._updateDisplay())},this._onCustomTimeChange=t=>{this._currentTime=t.detail.time,this._updateDisplay()},this.element=document.createElement("div"),this._video=null,this._currentTime=0,this._duration=0}}class tK extends tB{init(t,e){let i=this.element;t.initialized?this._updatePie({target:t}):t.once(w.READY,this._updatePie);let s=e.className.PIEVIEW_ROOT;i.classList.add(s),this.resetCamera&&i.addEventListener(v.CLICK,this._onClick),t.on(w.VIEW_CHANGE,this._updatePie),this._viewer=t}destroy(t){let e=this.element;e.removeEventListener(v.CLICK,this._onClick),e.className="",t.off(w.READY,this._updatePie),t.off(w.VIEW_CHANGE,this._updatePie),this._viewer=null}_createPieElements(){let t=this.element,e=document.createElementNS(V,"svg");e.setAttribute("viewBox","0 0 48 48"),e.setAttribute("width","100%"),e.setAttribute("height","100%");let i=document.createElementNS(V,"circle");i.setAttribute("stroke","currentColor"),i.setAttribute("fill","transparent"),i.setAttribute("cx","24"),i.setAttribute("cy","24"),i.setAttribute("r","12"),i.setAttribute("stroke-width","24"),e.appendChild(i);let s=document.createElementNS(V,"circle");s.setAttribute("stroke","currentColor"),s.setAttribute("fill","transparent"),s.setAttribute("cx","24"),s.setAttribute("cy","24"),s.setAttribute("r","22.5"),s.setAttribute("stroke-width","3"),e.appendChild(s),t.appendChild(e),this._piePathEl=i,this._rangeCircleEl=s}constructor({resetCamera:t=!0,position:e=tV.TOP_RIGHT,order:i=9999}={}){super({position:e,order:i}),this._onClick=()=>{let t=this._viewer,e=this.resetCamera;if(!t||!e)return;let{yaw:i=t.initialYaw,pitch:s=t.initialPitch,zoom:r=t.initialZoom,duration:n=500}=$(e);t.camera.animateTo({yaw:i,pitch:s,zoom:r,duration:n})},this._updatePie=t=>{let{target:e}=t,i=this._piePathEl,s=this._rangeCircleEl,r=e.camera,n=r.getHorizontalFov(),o=r.getYawRange(r.zoom),a=.5*n,l=24*Math.PI,h=l*n/360,_=l*(r.yaw+a+90)/360;if(i.setAttribute("stroke-dasharray","".concat(h," ").concat(l-h)),i.setAttribute("stroke-dashoffset","".concat(_)),isFinite(o.min)&&isFinite(o.max)){let t=45*Math.PI,e=(J(o.min,-180,180)-a)/360,i=t*Math.abs((J(o.max,-180,180)+a)/360-e);s.setAttribute("stroke-dasharray","".concat(i," ").concat(t-i)),s.setAttribute("stroke-dashoffset","".concat(-t*(e-.25)))}else s.setAttribute("stroke-dasharray",""),s.setAttribute("stroke-dashoffset","")},this.element=document.createElement("div"),this.element.title="Reset view",this.resetCamera=t,this._createPieElements(),this._viewer=null}}class tX extends tB{init(t,e){let i=this.element,s=e.className;i.classList.add(s.UNAVAILABLE),i.classList.add(s.VR_BUTTON),i.classList.add(s.CONTROLS_BUTTON),t.vr.isAvailable().then(t=>{t&&i.classList.remove(s.UNAVAILABLE)}),i.addEventListener(v.CLICK,this._onClick),this._viewer=t}destroy(){let t=this.element;t.className="",t.removeEventListener(v.CLICK,this._onClick),this._viewer=null}constructor({position:t=tV.MAIN_RIGHT,order:e=9999}={}){super({position:t,order:e}),this._onClick=()=>{let t=this._viewer;t&&t.vr.enter()},this.element=document.createElement(b),this.element.title="Enter VR",this._viewer=null}}class tj extends tB{init(t,e){let i=this.element,s=e.className;i.addEventListener(v.CLICK,this._onClick),i.classList.add(s.CONTROLS_BUTTON),i.classList.add(s.UNAVAILABLE);let r=()=>{i.classList.remove(s.UNAVAILABLE),t.control.gyro.on(S.ENABLE,this._updateStyle),t.control.gyro.on(S.DISABLE,this._updateStyle)};ti()?r():tT.isAvailable().then(t=>{t&&r()}),this._controlBar=e,this._viewer=t,this._updateStyle()}destroy(t){let e=this.element;t.control.gyro.off(S.ENABLE,this._updateStyle),t.control.gyro.off(S.DISABLE,this._updateStyle),e.removeEventListener(v.CLICK,this._onClick),e.className="",this._controlBar=null,this._viewer=null}constructor({position:t=tV.MAIN_RIGHT,order:e=9999}={}){super({position:t,order:e}),this._onClick=()=>{let t=this._viewer,e=this._controlBar;if(!t||!e)return;let i=t.control.gyro;i.enabled?i.disable():tT.requestSensorPermission().then(t=>{t?i.enable():this.element.classList.add(e.className.UNAVAILABLE)})},this._updateStyle=()=>{let t=this.element,e=this._viewer,i=this._controlBar;if(!e||!i)return;let s=e.control.gyro,r=i.className;s.enabled?(t.classList.add(r.GYRO_ENABLED),t.classList.remove(r.GYRO_DISABLED)):(t.classList.add(r.GYRO_DISABLED),t.classList.remove(r.GYRO_ENABLED))},this.element=document.createElement("div"),this.element.title="Toggle gyroscope control"}}class tZ{get enabled(){return!!this._targetEl}get hidden(){return this._controlBar.containerEl.classList.contains(this._hiddenClass)}get _hiddenClass(){return this._controlBar.className.HIDDEN}get _fixedClass(){return this._controlBar.className.FIXED}enable(t){var e;this._targetEl&&this.disable(t);let i=this._initialDelay,s=t.rootEl;this._targetEl=t.rootEl,this._timer=window.setTimeout(()=>{this.hide()},i),s.addEventListener(v.MOUSE_DOWN,this._onHold),s.addEventListener(v.MOUSE_ENTER,this._onMouseEnter),s.addEventListener(v.MOUSE_MOVE,this._onMouseMove),s.addEventListener(v.MOUSE_LEAVE,this._onMouseLeave),this._addFullscreenHandlers();let r=null===(e=t.mesh)||void 0===e?void 0:e.getTexture();r&&r.isVideo()&&(r.isPaused()&&this._controlBar.containerEl.classList.add(this._fixedClass),r.source.addEventListener(v.VIDEO_PLAY,this._onVideoPlay),r.source.addEventListener(v.VIDEO_PAUSE,this._onVideoPause),this._video=r)}disable(t){if(!this._targetEl)return;let e=this._controlBar,i=t.rootEl,s=this._video;i.removeEventListener(v.MOUSE_DOWN,this._onHold),window.removeEventListener(v.MOUSE_UP,this._onRelease),i.removeEventListener(v.MOUSE_ENTER,this._onMouseEnter),i.removeEventListener(v.MOUSE_MOVE,this._onMouseMove),i.removeEventListener(v.MOUSE_LEAVE,this._onMouseLeave),this._removeFullscreenHandlers(),window.clearTimeout(this._timer),e.containerEl.classList.remove(this._fixedClass),s&&(s.source.removeEventListener(v.VIDEO_PLAY,this._onVideoPlay),s.source.removeEventListener(v.VIDEO_PAUSE,this._onVideoPause)),this._isCursorInside=!1,this._isGrabbing=!1,this._video=null,this._targetEl=null}show(){this._clearHideTimer(),this._controlBar.containerEl.classList.remove(this._hiddenClass)}showTemporaliy(){this.show(),this._hideAfterDelay(this._idleDelay)}hide(){this._clearHideTimer(),this._controlBar.containerEl.classList.add(this._hiddenClass)}_clearHideTimer(){this._timer&&(window.clearTimeout(this._timer),this._timer=-1)}_hideAfterDelay(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._delay;this._isGrabbing||!this._isFullscreen&&this._isCursorInside||(this._clearHideTimer(),t<=0?this.hide():this._timer=window.setTimeout(()=>{this.hide()},t))}_addFullscreenHandlers(){f.forEach(t=>{document.addEventListener(t,this._onFullscreenChange)})}_removeFullscreenHandlers(){f.forEach(t=>{document.removeEventListener(t,this._onFullscreenChange)})}constructor(t,{initialDelay:e=3e3,delay:i=0,idleDelay:s=3e3}){this._onMouseEnter=()=>{this._isCursorInside=!0,this.show()},this._onMouseLeave=()=>{this._isCursorInside=!1,this._hideAfterDelay()},this._onMouseMove=()=>{this._isFullscreen&&this.showTemporaliy()},this._onHold=t=>{this._isGrabbing=!0,"mouse"===t.pointerType&&(this._isCursorInside=!0),window.addEventListener(v.MOUSE_UP,this._onRelease),this.show()},this._onRelease=()=>{this._isGrabbing=!1,window.removeEventListener(v.MOUSE_UP,this._onRelease),this._hideAfterDelay()},this._onVideoPlay=()=>{this._targetEl&&this._controlBar.containerEl.classList.remove(this._fixedClass)},this._onVideoPause=()=>{this._targetEl&&this._controlBar.containerEl.classList.add(this._fixedClass)},this._onFullscreenChange=()=>{this._isFullscreen=te(),this._isFullscreen&&this._hideAfterDelay()},this._controlBar=t,this._initialDelay=e,this._delay=i,this._idleDelay=s,this._timer=-1,this._isCursorInside=!1,this._isGrabbing=!1,this._isFullscreen=!1,this._video=null,this._targetEl=null}}class tq{enable(t,e){this._video=e,t.addEventListener(v.KEY_DOWN,this._onKeyDown,!0)}disable(t){this._video=null,t.removeEventListener(v.KEY_DOWN,this._onKeyDown,!0)}_changeVideoTime(t,e){t.currentTime+=e?5:-5,t.dispatchEvent(new CustomEvent(F,{detail:{time:t.currentTime}}))}_changeVideoVolume(t,e){let i=e?.1:-.1;t.muted?t.volume=Z(i,0,1):t.volume=Z(t.volume+i,0,1),t.volume>0?t.muted=!1:t.muted=!0}_toggleVideo(t){t.isPaused()?t.source.play():t.source.pause()}constructor(){this._onKeyDown=t=>{let e=this._video;if(!e)return;t.preventDefault(),t.stopPropagation();let i=e.source,s=null!=t.keyCode?a[t.keyCode]:R[t.key];switch(s){case"LEFT":case"RIGHT":return this._changeVideoTime(i,"RIGHT"===s);case"UP":case"DOWN":return this._changeVideoVolume(i,"UP"===s)}(32===t.keyCode||" "===t.key)&&this._toggleVideo(e)}}}class tJ{get rootEl(){return this._rootEl}get containerEl(){return this._containerEl}get backgroundEl(){return this._bgEl}get items(){return this._items}get customItems(){return this._customItems}init(t){let e=t.rootEl,i=this._rootEl,s=this._createDefaultItems();this._updateBackground(t),this._updateAutoHide(t),this._updateKeyboardHandler(t),e.appendChild(i),this._addItem(t,s),this._addItem(t,this._customItems),t.on(w.PROJECTION_CHANGE,this._onNewSrcLoad),t.on(w.STATIC_CLICK,this._onStaticClick)}destroy(t){let e=t.rootEl,i=this._rootEl,s=this._items;i.parentElement===e&&e.removeChild(i),Object.keys(s).forEach(e=>{s[e].forEach(e=>{e.destroy(t,this)}),s[e]=[]}),this._clearItemElements(),this._autoHider.disable(t),this._videoControl.disable(e),t.off(w.PROJECTION_CHANGE,this._onNewSrcLoad),t.off(w.STATIC_CLICK,this._onStaticClick)}_addItem(t,e){for(let i of e){let e=this._items[i.position],s=this._wrapperEl[i.position],r=Q(e,t=>t.order>i.order);if(r>=0){let t=e[r].element;e.splice(r,0,i),s.insertBefore(i.element,t)}else e.push(i),s.appendChild(i.element);i.init(t,this)}}_createPositionWrappers(){let t=Object.assign(Object.assign({},tJ.DEFAULT_CLASS),this.className),e=this._rootEl,i=W(t.CONTROLS_BG),s=W(t.CONTROLS_FLOAT_LEFT),r=W(t.CONTROLS_FLOAT_RIGHT);e.appendChild(s),e.appendChild(r);let n=W(t.CONTROLS_MAIN),o=W(t.CONTROLS_TOP),a=W(t.CONTROLS_BOTTOM),l=W(t.CONTROLS_MID),h=W(t.CONTROLS_LEFT),_=W(t.CONTROLS_RIGHT);l.appendChild(h),l.appendChild(_),n.appendChild(i),n.appendChild(o),n.appendChild(l),n.appendChild(a),e.appendChild(n),this._bgEl=i,this._containerEl=n,this._wrapperEl={[tJ.POSITION.MAIN_TOP]:o,[tJ.POSITION.MAIN_LEFT]:h,[tJ.POSITION.MAIN_RIGHT]:_,[tJ.POSITION.MAIN_BOTTOM]:a,[tJ.POSITION.TOP_LEFT]:s,[tJ.POSITION.TOP_RIGHT]:r}}_clearItemElements(){Object.keys(tJ.POSITION).map(t=>tJ.POSITION[t]).map(t=>this._wrapperEl[t]).forEach(t=>{for(;t.firstChild;)t.removeChild(t.firstChild)})}_updateAutoHide(t){var e;let i=this.autoHide,s=this._autoHider;if(null!=i)i?s.enable(t):s.disable(t);else{let i=null===(e=t.mesh)||void 0===e?void 0:e.getTexture();i&&i.isVideo()?s.enable(t):s.disable(t)}}_updateBackground(t){var e,i;let s=this._bgEl,r=this.showBackground,n=null!==(e=this.className.HIDDEN)&&void 0!==e?e:tJ.DEFAULT_CLASS.HIDDEN;if(null!=r)r?s.classList.remove(n):s.classList.add(n);else{let e=null===(i=t.mesh)||void 0===i?void 0:i.getTexture();e&&e.isVideo()?s.classList.remove(n):s.classList.add(n)}}_updateKeyboardHandler(t){var e;let i=t.rootEl,s=this._videoControl,r=null===(e=t.mesh)||void 0===e?void 0:e.getTexture();this.keyboardControls&&r&&r.isVideo()?s.enable(i,r):s.disable(i)}_createDefaultItems(){let t=[];return this.progressBar&&t.push(new tH($(this.progressBar))),this.playButton&&t.push(new tz($(this.playButton))),this.volumeButton&&t.push(new tk($(this.volumeButton))),this.gyroButton&&t.push(new tj($(this.gyroButton))),this.vrButton&&t.push(new tX($(this.vrButton))),this.fullscreenButton&&t.push(new tY($(this.fullscreenButton))),this.videoTime&&t.push(new tW($(this.videoTime))),this.pieView&&t.push(new tK($(this.pieView))),t}constructor({autoHide:t,showBackground:e,clickToPlay:i=!0,keyboardControls:s=!0,progressBar:r=!0,playButton:n=!0,volumeButton:o=!0,fullscreenButton:a=!0,videoTime:l=!0,pieView:h=!0,vrButton:_=!0,gyroButton:u=!0,className:d={},customItems:c=[]}={}){var E;this._onStaticClick=t=>{var e;let{target:i,isTouch:s}=t,r=this._autoHider;if(s){if(!r.enabled)return;r.hidden?r.showTemporaliy():r.hide()}else{if(!this.clickToPlay)return;let t=null===(e=i.mesh)||void 0===e?void 0:e.getTexture();if(!t||!t.isVideo())return;t.isPaused()?t.source.play():t.source.pause()}},this._onNewSrcLoad=t=>{let{target:e}=t,i=this._items;this._updateBackground(e),this._updateAutoHide(e),this._updateKeyboardHandler(e),Object.keys(i).forEach(t=>{i[t].forEach(t=>{t.destroy(e,this),t.init(e,this)})})},this.autoHide=t,this.showBackground=e,this.clickToPlay=i,this.keyboardControls=s,this.progressBar=r,this.playButton=n,this.volumeButton=o,this.fullscreenButton=a,this.videoTime=l,this.pieView=h,this.vrButton=_,this.gyroButton=u,this.className=Object.assign(Object.assign({},tJ.DEFAULT_CLASS),d);let m=null!==(E=d.CONTROLS_ROOT)&&void 0!==E?E:tJ.DEFAULT_CLASS.CONTROLS_ROOT;this._rootEl=W(m),this._createPositionWrappers(),this._items=Object.keys(tJ.POSITION).reduce((t,e)=>(t[tJ.POSITION[e]]=[],t),{}),this._customItems=c,this._autoHider=new tZ(this,$(t)),this._videoControl=new tq,c.forEach(t=>{this._items[t.position].push(t)})}}tJ.DEFAULT_CLASS=tF,tJ.POSITION=tV;class tQ{updateCamera(t){t.resetRange()}updateControl(t){t.ignoreZoomScale=!1}constructor({src:t,video:e=!1}){this.src=t,this.video=e}}class t${destroy(t){}constructor(){this.needsUpdate=!0}}class t0 extends tU{destroy(t){t.releaseVAO(this.vao),t.releaseShaderResources(this.program)}getTexture(){return this.program.uniforms.uTexture.texture}constructor(t,e){super(),this.vao=t,this.program=e}}class t1{constructor(t,e,i,s){this.program=t.createProgram(e,i),this.uniforms=s,this.uniformLocations=t.getUniformLocations(this.program,s)}}class t2{constructor(t,e){this.data=t,this.itemSize=e,this.count=t.length/e}}class t3{constructor(t,e,i){this.vertices=new t2(new Float32Array(t),3),this.indicies=new t2(new Uint16Array(e),1),this.uvs=new t2(new Float32Array(i),2)}}class t6 extends t${destroy(t){this.texture.destroy(),t.deleteTexture(this._webglTexture)}update(t,e,i){let s=this.texture,r=s.isVideo();t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,s.flipY),t.uniform1i(e,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._webglTexture),!r&&i?t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,s.source):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,s.source),r||(this.needsUpdate=!1)}constructor(t,e){super(),this.texture=e,this._webglTexture=t.createWebGLTexture(e)}}var t9="#define GLSLIFY 1\nuniform sampler2D uTexture;varying highp vec2 vUV;void main(){gl_FragColor=texture2D(uTexture,vUV.st);}";class t5 extends t3{constructor(){let t,e;let i=-.5*Math.PI,s=[],r=[],n=[];for(t=0;t<=60;t++){let o=(t/60-.5)*Math.PI,a=Math.sin(o),l=Math.cos(o);for(e=0;e<=60;e++){let o=(e/60-.5)*2*Math.PI+i,h=Math.sin(o),_=Math.cos(o)*l,u=h*l,d=e/60,c=t/60;if(s.push(d,c),r.push(_,a,u),60!==e&&60!==t){let i=61*t+e,s=i+60+1;n.push(i,i+1,s,s,i+1,s+1)}}}super(r,n,s)}}class t4 extends tQ{createMesh(t,e){let i={uTexture:new t6(t,e)},s=new t5,r=new t1(t,"#define GLSLIFY 1\nattribute vec3 position;attribute vec2 uv;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;varying highp vec2 vUV;void main(){vUV=uv;gl_Position=uPMatrix*uMVMatrix*vec4(position,1.0);}",t9,i);return new t0(t.createVAO(s,r),r)}constructor(t){super(t)}}class t8 extends t${update(t,e){t.uniform1f(e,this.val),this.needsUpdate=!1}constructor(t){super(),this.val=t}}class t7 extends t${update(t,e){t.uniform4fv(e,this.val.reduce((t,e)=>[...t,...e],[])),this.needsUpdate=!1}constructor(t){super(),this.val=t}}class et extends tQ{createMesh(t,e){let i,s;this._mode===et.MODE.LEFT_RIGHT?(i=[.5,1,0,0],s=[.5,1,.5,0]):(i=[1,.5,0,0],s=[1,.5,0,.5]);let r={uTexture:new t6(t,e),uEye:new t8(0),uTexScaleOffset:new t7([i,s])},n=new t5,o=new t1(t,"#define GLSLIFY 1\nattribute vec3 position;attribute vec2 uv;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;uniform vec4 uTexScaleOffset[2];uniform float uEye;varying highp vec2 vUV;void main(){vec4 scaleOffset=uTexScaleOffset[int(uEye)];vUV=uv.xy*scaleOffset.xy+scaleOffset.zw;gl_Position=uPMatrix*uMVMatrix*vec4(position,1.0);}",t9,r);return new t0(t.createVAO(n,o),o)}constructor(t){super(t),this._mode=t.mode}}et.MODE={LEFT_RIGHT:"left_right",TOP_BOTTOM:"top_bottom"};let ee=(t,e)=>{[_.Z.prototype,tP.prototype].forEach(i=>{Object.getOwnPropertyNames(i).filter(t=>"_"!==t.charAt(0)&&"constructor"!==t).forEach(s=>{let r=Object.getOwnPropertyDescriptor(i,s);if(r.value)Object.defineProperty(t,s,{value:function(){for(var t=arguments.length,i=Array(t),s=0;s<t;s++)i[s]=arguments[s];return r.value.call(this[e],...i)}});else{let i={};r.get&&(i.get=function(){var t;return this[e]&&(null===(t=r.get)||void 0===t?void 0:t.call(this[e]))}),r.set&&(i.set=function(){for(var t,i=arguments.length,s=Array(i),n=0;n<i;n++)s[n]=arguments[n];return null===(t=r.set)||void 0===t?void 0:t.call(this[e],...s)}),Object.defineProperty(t,s,i)}})})}}}]);